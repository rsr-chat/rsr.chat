"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8558],{5925(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"proto/extensions/reactions","title":"rsr.chat/reactions","description":"This specification is still a draft and is subject to change at any time.","source":"@site/content/proto/1500_extensions/reactions.md","sourceDirName":"proto/1500_extensions","slug":"/proto/extensions/reactions","permalink":"/docs/proto/extensions/reactions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"rsr.chat/reactions"},"sidebar":"protoSidebar","previous":{"title":"rsr.chat/rbac","permalink":"/docs/proto/extensions/rbac"},"next":{"title":"rsr.chat/typing-notify","permalink":"/docs/proto/extensions/typing-notify"}}');var s=i(4848),r=i(8453);const a={title:"rsr.chat/reactions"},c="rsr.chat/reactions",o={},d=[{value:"Motivation",id:"motivation",level:2},{value:"Capability",id:"capability",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"rsr.chat/message-link",id:"rsrchatmessage-link",level:3},{value:"rsr.chat/emote",id:"rsrchatemote",level:3},{value:"ISUPPORT Tokens",id:"isupport-tokens",level:2},{value:"Terminology",id:"terminology",level:2},{value:"The REACT Command",id:"the-react-command",level:2},{value:"The REACTLIST Command",id:"the-reactlist-command",level:2},{value:"Server Numerics",id:"server-numerics",level:2},{value:"Reaction State in Message Tags",id:"reaction-state-in-message-tags",level:2},{value:"Reaction Storage and Retention",id:"reaction-storage-and-retention",level:2},{value:"Message History Integration",id:"message-history-integration",level:2},{value:"Default Permissions",id:"default-permissions",level:2},{value:"Guild and Category Integration",id:"guild-and-category-integration",level:2},{value:"Channel Metadata Integration",id:"channel-metadata-integration",level:2},{value:"<code>reactions-enabled</code>",id:"reactions-enabled",level:3},{value:"Channel Membership Integration",id:"channel-membership-integration",level:2},{value:"RBAC Integration",id:"rbac-integration",level:2},{value:"Advanced Moderation Integration",id:"advanced-moderation-integration",level:2},{value:"Interaction with Non-Negotiating Clients",id:"interaction-with-non-negotiating-clients",level:2},{value:"Examples",id:"examples",level:2},{value:"Capability negotiation",id:"capability-negotiation",level:3},{value:"Placing a reaction",id:"placing-a-reaction",level:3},{value:"A second user reacts with the same emote",id:"a-second-user-reacts-with-the-same-emote",level:3},{value:"Removing a reaction via toggle",id:"removing-a-reaction-via-toggle",level:3},{value:"Using a custom emote",id:"using-a-custom-emote",level:3},{value:"REACTLIST with batch",id:"reactlist-with-batch",level:3},{value:"History replay with reaction summary tag",id:"history-replay-with-reaction-summary-tag",level:3},{value:"Unresolvable message ID",id:"unresolvable-message-id",level:3},{value:"Reactions disabled on channel",id:"reactions-disabled-on-channel",level:3},{value:"REACTIONMAX exceeded",id:"reactionmax-exceeded",level:3},{value:"REACTIONUSERMAX exceeded; truncated reactor list",id:"reactionusermax-exceeded-truncated-reactor-list",level:3},{value:"Self-reaction rejected",id:"self-reaction-rejected",level:3}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["This specification is still a ",(0,s.jsx)(n.strong,{children:"draft"})," and is subject to change at any time."]})}),"\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rsrchatreactions",children:"rsr.chat/reactions"})}),"\n",(0,s.jsxs)(n.p,{children:["This extension allows clients to attach emoji or custom emote reactions to individual\nmessages identified by their ",(0,s.jsx)(n.code,{children:"rsr.chat/message-link"})," message ID. Reactions are\naggregated per message per emote by the server and delivered as structured tag\nnotifications. The full reaction state for a channel is replayable via message history.\nAccess to reactions may be governed by ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," and ",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,s.jsx)(n.p,{children:"Message reactions are a standard affordance in modern messaging platforms that allow\nusers to respond to a message without producing a new message in the channel log. Without\na standard mechanism, IRC clients cannot interoperate on reaction state. This extension\ndefines a server-authoritative, ID-anchored reaction store that integrates cleanly with\nthe existing message identity and emote systems and degrades gracefully for clients that\nhave not negotiated the capability."}),"\n",(0,s.jsx)(n.h2,{id:"capability",children:"Capability"}),"\n",(0,s.jsxs)(n.p,{children:["This extension is advertised as the ",(0,s.jsx)(n.code,{children:"rsr.chat/reactions"})," capability during CAP\nnegotiation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CAP * LS :rsr.chat/reactions\n"})}),"\n",(0,s.jsx)(n.p,{children:"No capability value is used. Limits are communicated via ISUPPORT (see below)."}),"\n",(0,s.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsx)(n.h3,{id:"rsrchatmessage-link",children:"rsr.chat/message-link"}),"\n",(0,s.jsxs)(n.p,{children:["This extension requires that ",(0,s.jsx)(n.code,{children:"rsr.chat/message-link"})," be negotiated. Reactions are\naddressed by the ",(0,s.jsx)(n.code,{children:"rsr.chat/msgid"})," tag value assigned to each message by that extension.\nA reaction cannot be applied to a message that has no resolvable ID. All message ID\nsemantics, retention, and unresolvability rules defined by ",(0,s.jsx)(n.code,{children:"rsr.chat/message-link"})," apply\nequally to reaction targets."]}),"\n",(0,s.jsx)(n.h3,{id:"rsrchatemote",children:"rsr.chat/emote"}),"\n",(0,s.jsxs)(n.p,{children:["This extension requires that ",(0,s.jsx)(n.code,{children:"rsr.chat/emote"})," be negotiated. Emote identifiers used in\nreactions MUST be valid under the emote specification. Two emote classes are recognised\nby this extension:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unicode emoji"}),": a single Unicode emoji scalar or fully-qualified emoji sequence as\ndefined by the Unicode Emoji standard. Represented as the literal character sequence,\ne.g. ",(0,s.jsx)(n.code,{children:"\ud83d\udc4d"})," or ",(0,s.jsx)(n.code,{children:"\u2764\ufe0f"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Custom emote"}),": a custom emote identifier as defined by ",(0,s.jsx)(n.code,{children:"rsr.chat/emote"}),", expressed\nusing that specification's identifier syntax, e.g. ",(0,s.jsx)(n.code,{children:":blobwave:"})," or\n",(0,s.jsx)(n.code,{children:":acmecorp/blobwave:"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Servers MUST reject reaction attempts that reference an emote identifier not valid under\n",(0,s.jsx)(n.code,{children:"rsr.chat/emote"})," with ",(0,s.jsx)(n.code,{children:"ERR_REACTIONINVALIDEMOTE"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"isupport-tokens",children:"ISUPPORT Tokens"}),"\n",(0,s.jsxs)(n.p,{children:["Servers MUST advertise the following tokens in ",(0,s.jsx)(n.code,{children:"RPL_ISUPPORT"})," (005) when this capability\nis active:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REACTIONMAX=<n>"})," \u2014 the maximum number of distinct emotes that may be reacted to a\nsingle message. A value of ",(0,s.jsx)(n.code,{children:"0"})," indicates no server-imposed limit."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REACTIONUSERMAX=<n>"})," \u2014 the maximum number of users whose reactions are tracked per\nemote per message. A value of ",(0,s.jsx)(n.code,{children:"0"})," indicates no limit. When this limit is reached the\nserver MUST continue to accept reactions but MAY stop tracking individual reactor\nidentities for that emote, incrementing only the aggregate count."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    :server 005 nick REACTIONMAX=20 REACTIONUSERMAX=100 :are supported by this server\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If any of these values change after a configuration reload, a fresh ",(0,s.jsx)(n.code,{children:"RPL_ISUPPORT"})," MUST be\nsent to all connected clients."]}),"\n",(0,s.jsx)(n.h2,{id:"terminology",children:"Terminology"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reaction"}),": an association between a message ID, an emote, and the account or nick of\nthe user who placed it."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregate"}),": the server-maintained count of distinct users who have placed a given\nemote on a given message."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reactor"}),": a user who has placed a reaction."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Toggle semantics"}),": placing a reaction that the user has already placed removes it;\nplacing one they have not placed adds it."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"the-react-command",children:"The REACT Command"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    REACT <msgid> <emote>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Places or removes a reaction on the message identified by ",(0,s.jsx)(n.code,{children:"<msgid>"}),". Reactions follow\ntoggle semantics: if the calling user has already placed ",(0,s.jsx)(n.code,{children:"<emote>"})," on this message, the\nreaction is removed; otherwise it is added."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"<msgid>"})," MUST be a valid message ID of exactly ",(0,s.jsx)(n.code,{children:"MSGIDLEN"})," characters as defined by\n",(0,s.jsx)(n.code,{children:"rsr.chat/message-link"}),". The server MUST resolve the target message before accepting the\nreaction. If the message ID cannot be resolved the server MUST reply with\n",(0,s.jsx)(n.code,{children:"ERR_REACTIONUNKNOWNMSG"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"<emote>"})," MUST be a valid emote identifier under ",(0,s.jsx)(n.code,{children:"rsr.chat/emote"}),". The server MUST\nvalidate the emote before accepting the reaction. If the emote is not valid the server\nMUST reply with ",(0,s.jsx)(n.code,{children:"ERR_REACTIONINVALIDEMOTE"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["On success the server MUST broadcast a ",(0,s.jsx)(n.code,{children:"REACT"})," notification to all members of the\nchannel or conversation in which the target message resides that have negotiated this\ncapability:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":alice!alice@host REACT <msgid> <emote> <action> <count>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<action>"})," is ",(0,s.jsx)(n.code,{children:"add"})," if the reaction was placed or ",(0,s.jsx)(n.code,{children:"remove"})," if it was withdrawn."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<count>"})," is the updated aggregate count of users who have placed ",(0,s.jsx)(n.code,{children:"<emote>"})," on this\nmessage after applying this change."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Non-negotiating clients receive no notification."}),"\n",(0,s.jsx)(n.h2,{id:"the-reactlist-command",children:"The REACTLIST Command"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"REACTLIST <msgid>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Requests the full reaction state for the message identified by ",(0,s.jsx)(n.code,{children:"<msgid>"}),". The server\nresponds with zero or more ",(0,s.jsx)(n.code,{children:"RPL_REACTENTRY"})," numerics followed by ",(0,s.jsx)(n.code,{children:"RPL_REACTEND"}),". If IRCv3\n",(0,s.jsx)(n.code,{children:"batch"})," is negotiated the entire response MUST be wrapped in a ",(0,s.jsx)(n.code,{children:"rsr.chat/reactlist"})," batch."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"REACTLIST"})," may be issued by any client that is currently joined to the channel containing\nthe target message, or that holds persistent membership in it (see Channel Membership\nIntegration). Clients that lack visibility of the target channel MUST receive\n",(0,s.jsx)(n.code,{children:"ERR_REACTIONUNKNOWNMSG"})," as if the message did not exist."]}),"\n",(0,s.jsx)(n.h2,{id:"server-numerics",children:"Server Numerics"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Symbolic name"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RPL_REACTENTRY"})}),(0,s.jsx)(n.td,{children:"A single emote aggregate entry for a message"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RPL_REACTEND"})}),(0,s.jsx)(n.td,{children:"Marks the end of a REACTLIST response"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ERR_REACTIONUNKNOWNMSG"})}),(0,s.jsx)(n.td,{children:"The target message ID could not be resolved"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ERR_REACTIONINVALIDEMOTE"})}),(0,s.jsx)(n.td,{children:"The emote identifier is not valid under rsr.chat/emote"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ERR_REACTIONFULL"})}),(0,s.jsx)(n.td,{children:"The message has reached the REACTIONMAX distinct-emote limit"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ERR_REACTIONNOPERM"})}),(0,s.jsx)(n.td,{children:"The client lacks permission to react in this context"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RPL_REACTENTRY"})," has the following format:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server RPL_REACTENTRY <nick> <msgid> <emote> <count> :<reactors>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<emote>"})," is the emote identifier."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<count>"})," is the total number of users who have placed this reaction."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<reactors>"})," is a space-separated list of account names or nicks of up to\n",(0,s.jsx)(n.code,{children:"REACTIONUSERMAX"})," users who have placed this reaction. If ",(0,s.jsx)(n.code,{children:"REACTIONUSERMAX"})," has been\nexceeded for this emote the list MUST be truncated and the server MUST append the\ntoken ",(0,s.jsx)(n.code,{children:"+more"})," as the final element to signal that the list is incomplete."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RPL_REACTEND"})," has the following format:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server RPL_REACTEND <nick> <msgid> :End of reactions\n"})}),"\n",(0,s.jsx)(n.h2,{id:"reaction-state-in-message-tags",children:"Reaction State in Message Tags"}),"\n",(0,s.jsxs)(n.p,{children:["When a message is delivered to a negotiating client and that message already has one or\nmore reactions attached (e.g. during history replay), the server MUST include a\n",(0,s.jsx)(n.code,{children:"reaction-summary"})," tag on the message. The tag value is a\npipe-delimited list of ",(0,s.jsx)(n.code,{children:"<emote>:<count>"})," pairs, one per distinct emote that has at\nleast one reaction, ordered by descending count:"]}),"\n",(0,s.jsx)(n.p,{children:"rsr.chat/reaction-summary=\ud83d\udc4d:12|\u2764\ufe0f:7|:blobwave::3"}),"\n",(0,s.jsx)(n.p,{children:"This allows clients to render reaction counts inline with messages without requiring a\nseparate REACTLIST round-trip on initial load."}),"\n",(0,s.jsxs)(n.p,{children:["If a message has no reactions, the ",(0,s.jsx)(n.code,{children:"reaction-summary"})," tag MUST be omitted."]}),"\n",(0,s.jsx)(n.h2,{id:"reaction-storage-and-retention",children:"Reaction Storage and Retention"}),"\n",(0,s.jsx)(n.p,{children:"Reactions MUST be stored persistently by the server for as long as the referenced message\nis within the channel's history retention window. When a message expires from history,\nall reactions attached to it MUST also be discarded."}),"\n",(0,s.jsxs)(n.p,{children:["Reactions MUST NOT be stored for messages that are not within the history retention window\nat the time the reaction is placed. If a client attempts to react to a message whose ID\nis valid in format but is no longer in the retention window, the server MUST reply with\n",(0,s.jsx)(n.code,{children:"ERR_REACTIONUNKNOWNMSG"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"message-history-integration",children:"Message History Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When a client requests message history via ",(0,s.jsx)(n.code,{children:"CHATHISTORY"})," or an equivalent mechanism,\nrelayed messages MUST include the ",(0,s.jsx)(n.code,{children:"reaction-summary"})," tag reflecting the reaction\nstate at the time of the history request, not the state at original delivery time.\nReaction counts are live aggregates and their value in history replies MUST be current."]}),"\n",(0,s.jsxs)(n.p,{children:["Reaction add and remove events themselves MUST NOT appear as entries in the ",(0,s.jsx)(n.code,{children:"CHATHISTORY"}),"\nmessage log. They are metadata about messages, not messages in their own right."]}),"\n",(0,s.jsx)(n.h2,{id:"default-permissions",children:"Default Permissions"}),"\n",(0,s.jsxs)(n.p,{children:["Unless overridden by ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," or ",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"}),", the following\ndefault permission rules apply:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Any client currently joined to a channel MAY use REACT and REACTLIST for messages in\nthat channel."}),"\n",(0,s.jsx)(n.li,{children:"Persistent members who are not currently active (offline) MAY use REACTLIST but MUST\nNOT use REACT."}),"\n",(0,s.jsxs)(n.li,{children:["Removing another user's reaction is not permitted under any default permission. Only\nserver operators and, when ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," is negotiated, users with the\n",(0,s.jsx)(n.code,{children:"reaction.remove.any"})," permission MAY do so."]}),"\n",(0,s.jsx)(n.li,{children:"Server operators MAY use REACT and REACTLIST on any channel."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"guild-and-category-integration",children:"Guild and Category Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/guild"})," or ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-categories"})," are negotiated, reaction\nvisibility follows normal channel membership boundaries. There is no guild-wide or\ncategory-scoped reaction feed; reactions are scoped to the individual channel containing\nthe target message."]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-categories"})," is negotiated, RBAC rules for reaction permissions\nMAY be scoped to a category or guild prefix using the scope syntax defined by that\nspecification. See RBAC Integration."]}),"\n",(0,s.jsx)(n.h2,{id:"channel-metadata-integration",children:"Channel Metadata Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-metadata"})," is negotiated, the following key exists implicitly on\nevery channel and cannot be deleted:"]}),"\n",(0,s.jsx)(n.h3,{id:"reactions-enabled",children:(0,s.jsx)(n.code,{children:"reactions-enabled"})}),"\n",(0,s.jsxs)(n.p,{children:["Type: ",(0,s.jsx)(n.code,{children:"bool"}),". When ",(0,s.jsx)(n.code,{children:"false"}),", no reactions may be placed on messages in this channel. REACT\ncommands targeting this channel MUST be rejected with ERR_REACTIONNOPERM. Default: ",(0,s.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["This key may be set by channel operators or by users with the ",(0,s.jsx)(n.code,{children:"reaction.configure"})," RBAC\npermission. It is not read-only and may be set via CHANMETA SET."]}),"\n",(0,s.jsx)(n.h2,{id:"channel-membership-integration",children:"Channel Membership Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-membership"})," is negotiated, persistent members who are not\ncurrently active (offline) MAY call REACTLIST to inspect reaction state for channels in\nwhich they hold membership. This is consistent with the offline CHATHISTORY access\ndefined by ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-membership"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Offline persistent members MUST NOT be permitted to place or remove reactions via REACT.\nReactions imply active presence. If an offline member attempts REACT the server MUST\nreply with ERR_REACTIONNOPERM."}),"\n",(0,s.jsx)(n.h2,{id:"rbac-integration",children:"RBAC Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," is negotiated, the following permission identifiers are defined by\nthis extension:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Permission identifier"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.add"})}),(0,s.jsx)(n.td,{children:"Place a reaction on a message"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.remove.own"})}),(0,s.jsx)(n.td,{children:"Remove one's own reaction from a message"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.remove.any"})}),(0,s.jsx)(n.td,{children:"Remove any user's reaction from a message"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.list"})}),(0,s.jsx)(n.td,{children:"Call REACTLIST for messages in this channel"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.configure"})}),(0,s.jsxs)(n.td,{children:["Set the ",(0,s.jsx)(n.code,{children:"reactions-enabled"})," channel metadata key"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction.custom"})}),(0,s.jsx)(n.td,{children:"Place reactions using custom emotes (not Unicode emoji)"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Servers MUST reject REACT from clients that lack ",(0,s.jsx)(n.code,{children:"reaction.add"})," for the target channel\nwith ERR_REACTIONNOPERM."]}),"\n",(0,s.jsxs)(n.p,{children:["Servers MUST reject removal of another user's reaction from a client that lacks\n",(0,s.jsx)(n.code,{children:"reaction.remove.any"})," with ERR_REACTIONNOPERM."]}),"\n",(0,s.jsxs)(n.p,{children:["Servers MAY restrict custom emote reactions to clients that hold ",(0,s.jsx)(n.code,{children:"reaction.custom"}),". If a\nclient without ",(0,s.jsx)(n.code,{children:"reaction.custom"})," attempts to place a custom emote reaction the server\nMUST reply with ERR_REACTIONNOPERM."]}),"\n",(0,s.jsxs)(n.p,{children:["RBAC rules for reaction permissions MAY be scoped to a channel category or guild prefix\nusing the scope syntax defined by ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-categories"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"advanced-moderation-integration",children:"Advanced Moderation Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"})," is negotiated, the following predicates are defined\nfor use in moderation rule conditions (normative syntax defined by that specification):"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Predicate"}),(0,s.jsx)(n.th,{children:"Matches when"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:has-reactions"})}),(0,s.jsx)(n.td,{children:"The target message has at least one reaction"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:count>=<n>"})}),(0,s.jsx)(n.td,{children:"The total reaction count across all emotes is >= n"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:emote=<emote>"})}),(0,s.jsx)(n.td,{children:"The specified emote has at least one reaction"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:emote-count>=<n>"})}),(0,s.jsx)(n.td,{children:"The number of distinct emotes with reactions is >= n"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:is-custom"})}),(0,s.jsx)(n.td,{children:"The emote being placed is a custom emote"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"reaction:reactor=<account>"})}),(0,s.jsx)(n.td,{children:"The specified account has reacted to this message"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"These predicates may be used to enforce policies such as disabling custom emote reactions\nin certain channels, alerting on messages that accumulate a large number of reactions, or\nrestricting reaction-heavy threads."}),"\n",(0,s.jsx)(n.h2,{id:"interaction-with-non-negotiating-clients",children:"Interaction with Non-Negotiating Clients"}),"\n",(0,s.jsxs)(n.p,{children:["Non-negotiating clients receive no REACT notifications and cannot issue REACT or\nREACTLIST commands. REACT and REACTLIST sent by non-negotiating clients MUST be rejected\nwith ERR_UNKNOWNCOMMAND. Reaction state is entirely invisible to non-negotiating clients.\nMessages delivered to non-negotiating clients MUST NOT include the\n",(0,s.jsx)(n.code,{children:"rsr.chat/reaction-summary"})," tag."]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.h3,{id:"capability-negotiation",children:"Capability negotiation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CAP LS 302\nS: CAP * LS :rsr.chat/reactions rsr.chat/message-link rsr.chat/emote\nC: CAP REQ :rsr.chat/reactions rsr.chat/message-link rsr.chat/emote\nS: CAP * ACK :rsr.chat/reactions rsr.chat/message-link rsr.chat/emote\nC: NICK alice\nC: USER alice 0 * :Alice\nS: 005 alice REACTIONMAX=20 REACTIONUSERMAX=100 REACTIONSELF=1 MSGLINKMAX=5 MSGIDLEN=26 :are supported by this server\nS: 001 alice :Welcome to the network\n"})}),"\n",(0,s.jsx)(n.h3,{id:"placing-a-reaction",children:"Placing a reaction"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(bob sent a message that alice received as:)\n@MSGID=01HQ7K2N4R8VXJD3MCWBPZT56Y :bob!bob@host PRIVMSG #engineering/general :The deploy is fixed.\n\nC: REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d\nS: (broadcast to all negotiating channel members:)\n:alice!alice@host REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d add 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"a-second-user-reacts-with-the-same-emote",children:"A second user reacts with the same emote"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":carol!carol@host REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d add 2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"removing-a-reaction-via-toggle",children:"Removing a reaction via toggle"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    C: REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d\n    S: :alice!alice@host REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d remove 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"using-a-custom-emote",children:"Using a custom emote"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y :blobwave:\nS: :alice!alice@host REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y :blobwave: add 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"reactlist-with-batch",children:"REACTLIST with batch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: REACTLIST 01HQ7K2N4R8VXJD3MCWBPZT56Y\nS: :server BATCH +rl rsr.chat/reactlist 01HQ7K2N4R8VXJD3MCWBPZT56Y\nS: @batch=rl :server RPL_REACTENTRY alice 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d 2 :carol_acct alice_acct\nS: @batch=rl :server RPL_REACTENTRY alice 01HQ7K2N4R8VXJD3MCWBPZT56Y :blobwave: 1 :alice_acct\nS: :server BATCH -rl\nS: :server RPL_REACTEND alice 01HQ7K2N4R8VXJD3MCWBPZT56Y :End of reactions\n"})}),"\n",(0,s.jsx)(n.h3,{id:"history-replay-with-reaction-summary-tag",children:"History replay with reaction summary tag"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(client requests history for #engineering/general)\nS: :server BATCH +hist chathistory #engineering/general\nS: @batch=hist;rsr.chat/msgid=01HQ7K2N4R8VXJD3MCWBPZT56Y;rsr.chat/reaction-summary=\ud83d\udc4d:2|:blobwave::1 :bob!bob@host PRIVMSG #engineering/general :The deploy is fixed.\nS: :server BATCH -hist\n"})}),"\n",(0,s.jsx)(n.h3,{id:"unresolvable-message-id",children:"Unresolvable message ID"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: REACT 01HQXXXXXXXXXXXXXXXXXXXXXXXX \ud83d\udc4d\nS: :server ERR_REACTIONUNKNOWNMSG alice :Message ID could not be resolved\n"})}),"\n",(0,s.jsx)(n.h3,{id:"reactions-disabled-on-channel",children:"Reactions disabled on channel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(reactions-enabled metadata key is false for #announcements)\nC: REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d\nS: :server ERR_REACTIONNOPERM alice #announcements :Reactions are disabled in this channel\n"})}),"\n",(0,s.jsx)(n.h3,{id:"reactionmax-exceeded",children:"REACTIONMAX exceeded"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(message already has 20 distinct emotes)\nC: REACT 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83c\udf89\nS: :server ERR_REACTIONFULL alice 01HQ7K2N4R8VXJD3MCWBPZT56Y :Reaction emote limit reached\n"})}),"\n",(0,s.jsx)(n.h3,{id:"reactionusermax-exceeded-truncated-reactor-list",children:"REACTIONUSERMAX exceeded; truncated reactor list"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(101 users have reacted with \ud83d\udc4d and REACTIONUSERMAX=100)\nC: REACTLIST 01HQ7K2N4R8VXJD3MCWBPZT56Y\nS: @batch=rl :server RPL_REACTENTRY alice 01HQ7K2N4R8VXJD3MCWBPZT56Y \ud83d\udc4d 101 :user1_acct user2_acct ... user100_acct +more\n"})}),"\n",(0,s.jsx)(n.h3,{id:"self-reaction-rejected",children:"Self-reaction rejected"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(REACTIONSELF is absent from ISUPPORT; alice tries to react to her own message)\nC: REACT 01HQAB3T2F7PPXC4NK8RWLM09S \ud83d\udc4d\nS: :server ERR_REACTIONSELF alice :Self-reactions are not permitted on this server\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>c});var t=i(6540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);