"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8046],{6601(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"proto/extensions/channel-meta","title":"rsr.chat/channel-meta","description":"This specification is still a draft and is subject to change at any time.","source":"@site/docs/proto/1500_extensions/channel-meta.md","sourceDirName":"proto/1500_extensions","slug":"/proto/extensions/channel-meta","permalink":"/docs/proto/extensions/channel-meta","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"rsr.chat/channel-meta"},"sidebar":"protoSidebar","previous":{"title":"rsr.chat/channel-membership","permalink":"/docs/proto/extensions/channel-membership"},"next":{"title":"rsr.chat/channel-pins","permalink":"/docs/proto/extensions/channel-pins"}}');var s=i(4848),r=i(8453);const a={title:"rsr.chat/channel-meta"},d="rsr.chat/channel-meta",l={},c=[{value:"Motivation",id:"motivation",level:2},{value:"Capability",id:"capability",level:2},{value:"ISUPPORT Tokens",id:"isupport-tokens",level:2},{value:"Terminology",id:"terminology",level:2},{value:"Value Types",id:"value-types",level:2},{value:"Reserved Keys",id:"reserved-keys",level:2},{value:"<code>topic</code>",id:"topic",level:3},{value:"Commands",id:"commands",level:2},{value:"CHANMETA SET",id:"chanmeta-set",level:3},{value:"CHANMETA GET",id:"chanmeta-get",level:3},{value:"CHANMETA LIST",id:"chanmeta-list",level:3},{value:"CHANMETA DEL",id:"chanmeta-del",level:3},{value:"Server Numerics",id:"server-numerics",level:2},{value:"Long-Form Values",id:"long-form-values",level:2},{value:"Setting a long-form value",id:"setting-a-long-form-value",level:3},{value:"Receiving a long-form value",id:"receiving-a-long-form-value",level:3},{value:"Default Permissions",id:"default-permissions",level:2},{value:"Guild Integration",id:"guild-integration",level:2},{value:"Category Integration",id:"category-integration",level:2},{value:"RBAC Integration",id:"rbac-integration",level:2},{value:"Advanced Moderation Integration",id:"advanced-moderation-integration",level:2},{value:"Interaction with Non-Negotiating Clients",id:"interaction-with-non-negotiating-clients",level:2},{value:"Examples",id:"examples",level:2},{value:"Setting and retrieving a short-form key",id:"setting-and-retrieving-a-short-form-key",level:3},{value:"Setting the topic via CHANMETA and observing TOPIC broadcast",id:"setting-the-topic-via-chanmeta-and-observing-topic-broadcast",level:3},{value:"Type mismatch rejection",id:"type-mismatch-rejection",level:3},{value:"Exceeding key limit",id:"exceeding-key-limit",level:3},{value:"Listing all metadata on a channel",id:"listing-all-metadata-on-a-channel",level:3},{value:"Setting a long-form text value",id:"setting-a-long-form-text-value",level:3},{value:"Deleting a key",id:"deleting-a-key",level:3},{value:"Attempting to delete the reserved topic key",id:"attempting-to-delete-the-reserved-topic-key",level:3}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["This specification is still a ",(0,s.jsx)(n.strong,{children:"draft"})," and is subject to change at any time."]})}),"\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rsrchatchannel-meta",children:"rsr.chat/channel-meta"})}),"\n",(0,s.jsx)(n.p,{children:"This extension allows arbitrary typed key-value metadata to be attached to channels.\nMetadata entries may be short-form (single-line) or long-form (multi-line or extended).\nThe channel topic is defined as an implicit metadata key and may be managed through either\nthe standard TOPIC command or the metadata interface defined here."}),"\n",(0,s.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,s.jsx)(n.p,{children:"IRC channels have historically carried only a small set of fixed attributes: a name, a\ntopic, a mode string, and a creation timestamp. Modern applications require richer\nstructured metadata \u2014 descriptions, icons, language tags, custom configuration values \u2014\nwithout polluting the mode string or abusing the topic field. This extension provides a\ngeneral-purpose, typed, access-controlled metadata store per channel."}),"\n",(0,s.jsx)(n.h2,{id:"capability",children:"Capability"}),"\n",(0,s.jsxs)(n.p,{children:["This extension is advertised as the ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-meta"})," capability during CAP\nnegotiation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CAP * LS :rsr.chat/channel-metadata\n"})}),"\n",(0,s.jsx)(n.p,{children:"No capability value is used. Limits are communicated via ISUPPORT (see below)."}),"\n",(0,s.jsx)(n.h2,{id:"isupport-tokens",children:"ISUPPORT Tokens"}),"\n",(0,s.jsx)(n.p,{children:"Servers MUST advertise the following tokens in RPL_ISUPPORT (005) when this capability is\nactive:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CHANMETAKEYS=<n>"})," \u2014 the maximum number of metadata keys permitted per channel."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CHANMETALEN=<n>"})," \u2014 the maximum byte length of a short-form metadata value."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CHANMETALONGLEN=<n>"})," \u2014 the maximum total byte length of a long-form metadata value.\nIf the server does not support long-form values, this token MUST be omitted."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server 005 nick CHANMETAKEYS=64 CHANMETALEN=390 CHANMETALONGLEN=8192 :are supported by this server\n"})}),"\n",(0,s.jsx)(n.p,{children:"If any of these limits change (e.g. after a configuration reload), a fresh RPL_ISUPPORT\nMUST be sent to all connected clients."}),"\n",(0,s.jsx)(n.h2,{id:"terminology",children:"Terminology"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Key"}),": a metadata identifier. Keys are case-insensitive ASCII strings matching the\npattern ",(0,s.jsx)(n.code,{children:"[A-Za-z0-9][A-Za-z0-9_-]*"}),", with a maximum length of 64 characters."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type"}),": a declared value type associated with a key at the time of its creation. The\ntype is immutable for the lifetime of the key."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Short-form value"}),": a value that fits within a single IRC message line, up to\n",(0,s.jsx)(n.code,{children:"CHANMETALEN"})," bytes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Long-form value"}),": a value that may span multiple lines or exceed ",(0,s.jsx)(n.code,{children:"CHANMETALEN"})," bytes,\nup to ",(0,s.jsx)(n.code,{children:"CHANMETALONGLEN"})," bytes. Long-form values require ",(0,s.jsx)(n.code,{children:"rsr.chat/extended-line-length"}),"\nor the multiline batch mechanism defined in this specification (see Long-Form Values)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reserved key"}),": a key whose name and semantics are defined by this or another\nspecification. Reserved keys MUST NOT be created or deleted by clients; they exist\nimplicitly (see Reserved Keys)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"value-types",children:"Value Types"}),"\n",(0,s.jsx)(n.p,{children:"Every metadata key carries a declared type. The following types are defined:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type identifier"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Form"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"A UTF-8 string with no embedded newlines"}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int"})}),(0,s.jsx)(n.td,{children:"A signed 64-bit decimal integer"}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint"})}),(0,s.jsx)(n.td,{children:"An unsigned 64-bit decimal integer"}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bool"})}),(0,s.jsxs)(n.td,{children:["Exactly the string ",(0,s.jsx)(n.code,{children:"true"})," or ",(0,s.jsx)(n.code,{children:"false"})]}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"url"})}),(0,s.jsxs)(n.td,{children:["An absolute URL; scheme MUST be ",(0,s.jsx)(n.code,{children:"http"})," or ",(0,s.jsx)(n.code,{children:"https"})]}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"color"})}),(0,s.jsxs)(n.td,{children:["A CSS-style hex color code, e.g. ",(0,s.jsx)(n.code,{children:"#ff8800"})]}),(0,s.jsx)(n.td,{children:"Short"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"text"})}),(0,s.jsx)(n.td,{children:"A UTF-8 string that may contain newlines or exceed"}),(0,s.jsx)(n.td,{children:"Long"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"CHANMETALEN"})," bytes"]}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Servers MUST reject values that do not conform to the declared type with\n",(0,s.jsx)(n.code,{children:"ERR_CHANMETABADVALUE"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"reserved-keys",children:"Reserved Keys"}),"\n",(0,s.jsx)(n.p,{children:"The following keys exist implicitly on every channel and do not need to be created. They\ncannot be deleted."}),"\n",(0,s.jsx)(n.h3,{id:"topic",children:(0,s.jsx)(n.code,{children:"topic"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"topic"})," key mirrors the channel's topic. Its type is ",(0,s.jsx)(n.code,{children:"text"}),"."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["When a client sets the topic via the standard TOPIC command, the server MUST update the\n",(0,s.jsx)(n.code,{children:"topic"})," metadata key as if ",(0,s.jsx)(n.code,{children:"CHANMETA SET"})," had been called."]}),"\n",(0,s.jsxs)(n.li,{children:["When a client sets the ",(0,s.jsx)(n.code,{children:"topic"})," metadata key via ",(0,s.jsx)(n.code,{children:"CHANMETA SET"}),", the server MUST broadcast\na standard TOPIC notification to all channel members as if the TOPIC command had been\nused."]}),"\n",(0,s.jsxs)(n.li,{children:["The permission required to set ",(0,s.jsx)(n.code,{children:"topic"})," via ",(0,s.jsx)(n.code,{children:"CHANMETA SET"})," is identical to the permission\nrequired to change the topic via the TOPIC command under the channel's current mode."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"No other keys are reserved by this specification. Future extensions MAY define additional\nreserved keys."}),"\n",(0,s.jsx)(n.h2,{id:"commands",children:"Commands"}),"\n",(0,s.jsx)(n.h3,{id:"chanmeta-set",children:"CHANMETA SET"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CHANMETA <channel> SET <key> <type> :<value>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Creates or updates a metadata key on the specified channel. If the key does not yet exist,\nit is created with the given type. If the key already exists, the type argument MUST match\nthe previously declared type; a mismatch MUST result in ERR_CHANMETABADTYPE."}),"\n",(0,s.jsxs)(n.p,{children:["The value is provided as a trailing parameter. For short-form types this MUST be a single\ntrailing parameter. For long-form (",(0,s.jsx)(n.code,{children:"text"}),") values, see Long-Form Values."]}),"\n",(0,s.jsxs)(n.p,{children:["On success the server MUST broadcast a ",(0,s.jsx)(n.code,{children:"CHANMETA SET"})," message to all channel members that\nhave negotiated this capability:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":setter!user@host CHANMETA #channel SET <key> <type> :<value>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Members that have not negotiated the capability receive no notification, with the exception\nof the ",(0,s.jsx)(n.code,{children:"topic"})," key (see Reserved Keys)."]}),"\n",(0,s.jsx)(n.h3,{id:"chanmeta-get",children:"CHANMETA GET"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CHANMETA <channel> GET <key>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Requests the current value of a single metadata key. The server replies with\n",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"}),", followed by ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAEND"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"chanmeta-list",children:"CHANMETA LIST"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CHANMETA <channel> LIST\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Requests all metadata keys on the channel. The server replies with zero or more\n",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"})," numerics, followed by ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAEND"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"chanmeta-del",children:"CHANMETA DEL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CHANMETA <channel> DEL <key>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Deletes a metadata key. Reserved keys MUST NOT be deleted; attempts MUST result in\n",(0,s.jsx)(n.code,{children:"ERR_CHANMETAREADONLY"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["On success the server MUST broadcast a ",(0,s.jsx)(n.code,{children:"CHANMETA DEL"})," message to all channel members that\nhave negotiated this capability:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":setter!user@host CHANMETA #channel DEL <key>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"server-numerics",children:"Server Numerics"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Symbolic name"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RPL_CHANMETAENTRY"}),(0,s.jsx)(n.td,{children:"A single key-value metadata entry (see below)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RPL_CHANMETAEND"}),(0,s.jsx)(n.td,{children:"Marks the end of a GET or LIST response"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETABADTYPE"}),(0,s.jsx)(n.td,{children:"The supplied type does not match the key's declared type"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETABADVALUE"}),(0,s.jsx)(n.td,{children:"The value does not conform to the declared type"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETAREADONLY"}),(0,s.jsx)(n.td,{children:"The key is reserved and cannot be set or deleted"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETAUNKNOWN"}),(0,s.jsx)(n.td,{children:"The requested key does not exist"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETAFULL"}),(0,s.jsx)(n.td,{children:"The channel has reached the CHANMETAKEYS limit"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ERR_CHANMETANOPERM"}),(0,s.jsx)(n.td,{children:"The client lacks permission to perform this operation"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"RPL_CHANMETAENTRY has the following format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server RPL_CHANMETAENTRY <nick> <channel> <key> <type> :<value>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For long-form values, ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"})," MUST be preceded by a ",(0,s.jsx)(n.code,{children:"rsr.chat/chanmeta-batch"}),"\nbatch opening (see Long-Form Values)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RPL_CHANMETAEND"})," has the following format:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server RPL_CHANMETAEND <nick> <channel> :End of channel metadata\n"})}),"\n",(0,s.jsx)(n.h2,{id:"long-form-values",children:"Long-Form Values"}),"\n",(0,s.jsxs)(n.p,{children:["Long-form values use the ",(0,s.jsx)(n.code,{children:"text"})," type and may contain embedded newlines or exceed\n",(0,s.jsx)(n.code,{children:"CHANMETALEN"})," bytes. Servers that advertise ",(0,s.jsx)(n.code,{children:"CHANMETALONGLEN"})," in ISUPPORT MUST support\nthis mechanism. Servers that do not advertise ",(0,s.jsx)(n.code,{children:"CHANMETALONGLEN"})," MUST reject any attempt\nto set a ",(0,s.jsx)(n.code,{children:"text"}),"-typed key with ",(0,s.jsx)(n.code,{children:"ERR_CHANMETABADTYPE"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"setting-a-long-form-value",children:"Setting a long-form value"}),"\n",(0,s.jsxs)(n.p,{children:["Clients signal a long-form value by opening a ",(0,s.jsx)(n.code,{children:"rsr.chat/chanmeta-batch"})," batch:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"BATCH +<ref> rsr.chat/chanmeta-batch <channel> SET <key> text\n@batch=<ref> CHANMETABODY :<line one>\n@batch=<ref> CHANMETABODY :<line two>\nBATCH -<ref>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each CHANMETABODY line contributes one UTF-8 line to the value. Newlines are inserted\nbetween consecutive CHANMETABODY payloads. The total assembled byte length MUST NOT\nexceed ",(0,s.jsx)(n.code,{children:"CHANMETALONGLEN"}),"; the server MUST reject the batch with ",(0,s.jsx)(n.code,{children:"ERR_CHANMETABADVALUE"})," if\nthis limit is exceeded."]}),"\n",(0,s.jsx)(n.h3,{id:"receiving-a-long-form-value",children:"Receiving a long-form value"}),"\n",(0,s.jsxs)(n.p,{children:["When a server sends a long-form value in response to ",(0,s.jsx)(n.code,{children:"CHANMETA GET"})," or ",(0,s.jsx)(n.code,{children:"CHANMETA LIST"}),", it\nMUST wrap the ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"})," in a ",(0,s.jsx)(n.code,{children:"rsr.chat/chanmeta-batch"})," batch:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server BATCH +<ref> rsr.chat/chanmeta-batch <channel> GET <key> text\n:server @batch=<ref> RPL_CHANMETAENTRY <nick> <channel> <key> text :<line one>\n:server @batch=<ref> RPL_CHANMETAENTRY <nick> <channel> <key> text :<line two>\n:server BATCH -<ref>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"})," in the batch carries one line of the value. Clients MUST\nconcatenate lines with a newline character to reconstruct the full value."]}),"\n",(0,s.jsxs)(n.p,{children:["If a client has not negotiated IRCv3 batch support, servers MUST omit long-form values\nfrom ",(0,s.jsx)(n.code,{children:"CHANMETA LIST"})," responses entirely and MUST reply to ",(0,s.jsx)(n.code,{children:"CHANMETA GET"})," for a ",(0,s.jsx)(n.code,{children:"text"})," key\nwith ",(0,s.jsx)(n.code,{children:"ERR_CHANMETABADTYPE"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"default-permissions",children:"Default Permissions"}),"\n",(0,s.jsxs)(n.p,{children:["Unless overridden by ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," or ",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"}),", the following\ndefault permission rules apply:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Any channel member MAY call ",(0,s.jsx)(n.code,{children:"CHANMETA GET"})," and ",(0,s.jsx)(n.code,{children:"CHANMETA LIST"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Channel operators (mode ",(0,s.jsx)(n.code,{children:"+o"}),") MAY call ",(0,s.jsx)(n.code,{children:"CHANMETA SET"})," and ",(0,s.jsx)(n.code,{children:"CHANMETA DEL"})," for any\nnon-reserved key."]}),"\n",(0,s.jsxs)(n.li,{children:["Setting the ",(0,s.jsx)(n.code,{children:"topic"})," key follows the same rules as the TOPIC command under the channel's\ncurrent mode."]}),"\n",(0,s.jsxs)(n.li,{children:["Server operators MAY call ",(0,s.jsx)(n.code,{children:"CHANMETA SET"})," and ",(0,s.jsx)(n.code,{children:"CHANMETA DEL"})," on any channel for any key."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"guild-integration",children:"Guild Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/guild"})," is negotiated, a guild operator MAY set metadata defaults for all\nchannels within a guild using the guild-prefix scope syntax defined by the guild\nspecification. A guild-level default is overridden by any channel-specific value for the\nsame key. Guild-level defaults MUST appear in ",(0,s.jsx)(n.code,{children:"CHANMETA LIST"})," responses with a ",(0,s.jsx)(n.code,{children:"default"}),"\nflag appended to the ",(0,s.jsx)(n.code,{children:"RPL_CHANMETAENTRY"})," line:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:":server RPL_CHANMETAENTRY <nick> <channel> <key> <type> :<value> (default)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The parenthetical ",(0,s.jsx)(n.code,{children:"(default)"})," is a server-supplied annotation token. Clients SHOULD\ndisplay or expose this distinction to the user."]}),"\n",(0,s.jsx)(n.h2,{id:"category-integration",children:"Category Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-categories"})," is negotiated, metadata defaults MAY be set at the\ncategory scope using the category scope identifier syntax defined by that specification\n(",(0,s.jsx)(n.code,{children:"#category/"}),"). Category-scoped defaults follow the same precedence rules as described\nin that specification:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Channel-specific values take precedence over category-scoped defaults."}),"\n",(0,s.jsx)(n.li,{children:"Category-scoped defaults take precedence over guild-level defaults."}),"\n",(0,s.jsx)(n.li,{children:"Guild-level defaults take precedence over server-wide defaults."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["A category-scoped default is also surfaced in ",(0,s.jsx)(n.code,{children:"CHANMETA LIST"})," responses with a ",(0,s.jsx)(n.code,{children:"default"}),"\nannotation (see Guild Integration above)."]}),"\n",(0,s.jsx)(n.h2,{id:"rbac-integration",children:"RBAC Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/rbac"})," is negotiated, per-key permissions MAY be defined using the RBAC\nrule syntax defined by that specification. The following permission identifiers are\ndefined by this extension for use in RBAC rules:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Permission identifier"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta.get"})}),(0,s.jsx)(n.td,{children:"Read any metadata key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta.set.<key>"})}),(0,s.jsx)(n.td,{children:"Set the named key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta.del.<key>"})}),(0,s.jsx)(n.td,{children:"Delete the named key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta.set.*"})}),(0,s.jsx)(n.td,{children:"Set any non-reserved metadata key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta.del.*"})}),(0,s.jsx)(n.td,{children:"Delete any non-reserved metadata key"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["RBAC rules for metadata permissions MAY be scoped to a channel category or guild prefix\nusing the scope syntax defined by ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-categories"}),". A scoped rule applies to\nall matching channels as described in that specification."]}),"\n",(0,s.jsx)(n.p,{children:"Example (illustrative; normative RBAC syntax defined in rsr.chat/rbac):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"RBACSET #engineering/ ROLE moderator PERMISSION chanmeta.set.topic\nRBACSET #acmecorp/ ROLE admin PERMISSION chanmeta.set.*\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-moderation-integration",children:"Advanced Moderation Integration"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"})," is negotiated, metadata keys MAY be used as criteria\nin moderation rules. The normative syntax for such rules is defined by\n",(0,s.jsx)(n.code,{children:"rsr.chat/advanced-moderation"}),". This specification defines the following metadata\npredicates for use in moderation rule conditions:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Predicate"}),(0,s.jsx)(n.th,{children:"Matches when"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta:<key>=<value>"})}),(0,s.jsx)(n.td,{children:"The key exists and equals the given value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta:<key>~=<value>"})}),(0,s.jsx)(n.td,{children:"The key exists and contains the given value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta:<key> exists"})}),(0,s.jsx)(n.td,{children:"The key exists regardless of value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"chanmeta:<key> missing"})}),(0,s.jsx)(n.td,{children:"The key does not exist"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"These predicates MAY be used to restrict joins, posting, or other actions based on channel\nmetadata state."}),"\n",(0,s.jsx)(n.h2,{id:"interaction-with-non-negotiating-clients",children:"Interaction with Non-Negotiating Clients"}),"\n",(0,s.jsxs)(n.p,{children:["Clients that have not negotiated ",(0,s.jsx)(n.code,{children:"rsr.chat/channel-metadata"})," receive no CHANMETA\nnotifications. They interact with the ",(0,s.jsx)(n.code,{children:"topic"})," reserved key solely through the standard\nTOPIC command and RPL_TOPIC (332) numeric, which the server MUST continue to send\nnormally. All other metadata is invisible to such clients."]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.h3,{id:"setting-and-retrieving-a-short-form-key",children:"Setting and retrieving a short-form key"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general SET lang string :en-GB\nS: :alice!alice@host CHANMETA #engineering/general SET lang string :en-GB\n    (broadcast to all members that negotiated the capability)\n\nC: CHANMETA #engineering/general GET lang\nS: :server RPL_CHANMETAENTRY alice #engineering/general lang string :en-GB\nS: :server RPL_CHANMETAEND alice #engineering/general :End of channel metadata\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setting-the-topic-via-chanmeta-and-observing-topic-broadcast",children:"Setting the topic via CHANMETA and observing TOPIC broadcast"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general SET topic text\n    (long-form via batch, see Long-Form Values section)\nS: :alice!alice@host TOPIC #engineering/general :This channel is for general engineering discussion.\n    (broadcast to all members including non-negotiating clients)\nS: :alice!alice@host CHANMETA #engineering/general SET topic text :(same value, to negotiating clients)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"type-mismatch-rejection",children:"Type mismatch rejection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general SET lang int :42\nS: :server ERR_CHANMETABADTYPE alice #engineering/general lang :Key type is string, not int\n"})}),"\n",(0,s.jsx)(n.h3,{id:"exceeding-key-limit",children:"Exceeding key limit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general SET newkey string :value\nS: :server ERR_CHANMETAFULL alice #engineering/general :Channel metadata key limit reached\n"})}),"\n",(0,s.jsx)(n.h3,{id:"listing-all-metadata-on-a-channel",children:"Listing all metadata on a channel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general LIST\nS: :server RPL_CHANMETAENTRY alice #engineering/general lang string :en-GB\nS: :server RPL_CHANMETAENTRY alice #engineering/general color color :#3498db\nS: :server RPL_CHANMETAENTRY alice #engineering/general topic text :(default)\nS: :server RPL_CHANMETAEND alice #engineering/general :End of channel metadata\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setting-a-long-form-text-value",children:"Setting a long-form text value"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: BATCH +meta1 rsr.chat/chanmeta-batch #engineering/general SET description text\nC: @batch=meta1 CHANMETABODY :This channel is for day-to-day engineering discussion.\nC: @batch=meta1 CHANMETABODY :Please keep discussion on-topic.\nC: BATCH -meta1\nS: :alice!alice@host CHANMETA #engineering/general SET description text\n    :This channel is for day-to-day engineering discussion.\\nPlease keep discussion on-topic.\n    (broadcast to negotiating members)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"deleting-a-key",children:"Deleting a key"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general DEL lang\nS: :alice!alice@host CHANMETA #engineering/general DEL lang\n"})}),"\n",(0,s.jsx)(n.h3,{id:"attempting-to-delete-the-reserved-topic-key",children:"Attempting to delete the reserved topic key"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"C: CHANMETA #engineering/general DEL topic\nS: :server ERR_CHANMETAREADONLY alice #engineering/general topic :This key is read-only\n"})})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>d});var t=i(6540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);