"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[416],{3497(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"proto/extensions/message-link","title":"rsr.chat/message-link","description":"This specification is still a draft and is subject to change at any time.","source":"@site/docs/proto/1500_extensions/message-link.md","sourceDirName":"proto/1500_extensions","slug":"/proto/extensions/message-link","permalink":"/docs/proto/extensions/message-link","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"rsr.chat/message-link"},"sidebar":"protoSidebar","previous":{"title":"rsr.chat/extended-line-length","permalink":"/docs/proto/extensions/extended-message-length"},"next":{"title":"rsr.chat/modern-ping","permalink":"/docs/proto/extensions/modern-ping"}}');var t=i(4848),r=i(8453);const a={title:"rsr.chat/message-link"},l="rsr.chat/message-link",c={},o=[{value:"Motivation",id:"motivation",level:2},{value:"Capability",id:"capability",level:2},{value:"ISUPPORT Tokens",id:"isupport-tokens",level:2},{value:"Message ID Tags",id:"message-id-tags",level:2},{value:"Inline Link Syntax",id:"inline-link-syntax",level:2},{value:"Example body with a reference",id:"example-body-with-a-reference",level:3},{value:"Client Rendering",id:"client-rendering",level:2},{value:"Unresolvable and Expired References",id:"unresolvable-and-expired-references",level:2},{value:"Message History",id:"message-history",level:2},{value:"Cross-Channel References",id:"cross-channel-references",level:2},{value:"Examples",id:"examples",level:2},{value:"Capability negotiation",id:"capability-negotiation",level:3},{value:"Messages delivered with ID tags",id:"messages-delivered-with-id-tags",level:3},{value:"Sending a message that references a prior one",id:"sending-a-message-that-references-a-prior-one",level:3},{value:"Exceeding MSGLINKMAX",id:"exceeding-msglinkmax",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["This specification is still a ",(0,t.jsx)(n.strong,{children:"draft"})," and is subject to change at any time."]})}),"\n",(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"rsrchatmessage-link",children:"rsr.chat/message-link"})}),"\n",(0,t.jsx)(n.p,{children:"This extension assigns a unique server-generated ID tag to every message and provides an\ninline syntax by which clients may reference a prior message within a later one. Servers\nresolve inline link references and attach structured tags so that receiving clients can\ndisplay contextual previews or threading UI without querying history separately. The\nmechanism integrates with message history replay, channel metadata, and the access control\nextensions."}),"\n",(0,t.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,t.jsx)(n.p,{children:"Threaded or quoted replies are a fundamental feature of modern messaging platforms. IRC\nhas historically had no standard mechanism for this: clients either paste truncated text\nquotes manually or rely on proprietary conventions. This extension provides a\nserver-authoritative, ID-based reference system that is compact on the wire, survives\nhistory replay faithfully, and degrades gracefully for clients that have not negotiated\nthe capability."}),"\n",(0,t.jsx)(n.h2,{id:"capability",children:"Capability"}),"\n",(0,t.jsxs)(n.p,{children:["This extension is advertised as the ",(0,t.jsx)(n.code,{children:"rsr.chat/message-link"})," capability during CAP\nnegotiation:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CAP * LS :rsr.chat/message-link\n"})}),"\n",(0,t.jsx)(n.p,{children:"No capability value is used. Supplementary limits are communicated via ISUPPORT (see\nbelow)."}),"\n",(0,t.jsx)(n.h2,{id:"isupport-tokens",children:"ISUPPORT Tokens"}),"\n",(0,t.jsxs)(n.p,{children:["Servers MUST advertise the following tokens in ",(0,t.jsx)(n.code,{children:"RPL_ISUPPORT"})," (005) when this capability\nis active:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"MSGLINKMAX=<n>"})," \u2014 the maximum number of inline message references permitted in a\nsingle outbound message. Servers MUST NOT enforce a value lower than 1."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"MSGLINKLEN=<n>"})," \u2014 the byte length of server-generated message IDs. Clients MUST treat\nIDs as opaque byte strings of exactly this length and MUST NOT assume any internal\nstructure."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:":server 005 nick MSGLINKMAX=5 MSGLINKLEN=26 :are supported by this server\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If these values change after a configuration reload, a fresh ",(0,t.jsx)(n.code,{children:"RPL_ISUPPORT"})," MUST be sent\nto all connected clients."]}),"\n",(0,t.jsx)(n.h2,{id:"message-id-tags",children:"Message ID Tags"}),"\n",(0,t.jsxs)(n.p,{children:["When this capability is active, the server MUST attach a ",(0,t.jsx)(n.code,{children:"MSGLINK"})," message tag to\nevery ",(0,t.jsx)(n.code,{children:"PRIVMSG"})," and ",(0,t.jsx)(n.code,{children:"NOTICE"})," it delivers to any client that has negotiated this capability.\nThe tag value is a server-generated, globally unique, URL-safe base64 string of exactly\n",(0,t.jsx)(n.code,{children:"MSGLINKLEN"})," bytes. Message IDs MUST be unique within the lifetime of the server instance\nand SHOULD be unique across restarts."]}),"\n",(0,t.jsxs)(n.p,{children:["The tag is attached by the server and MUST NOT be accepted from clients. If a client\nsends a message that includes a ",(0,t.jsx)(n.code,{children:"MSGLINK"})," tag, the server MUST strip it before\nrelay."]}),"\n",(0,t.jsx)(n.p,{children:"Example message as received by a negotiating client:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"@MSGLINK=01HQ7K2N4R8VXJD3MCWBPZT56Y :alice!alice@host PRIVMSG #engineering/general :hello\n"})}),"\n",(0,t.jsx)(n.p,{children:"Clients that have not negotiated this capability receive messages without the tag. The\ntag MUST be preserved in message history storage and replayed verbatim during history\nretrieval (see Message History)."}),"\n",(0,t.jsx)(n.h2,{id:"inline-link-syntax",children:"Inline Link Syntax"}),"\n",(0,t.jsx)(n.p,{children:"A message may reference a prior message by embedding a link token anywhere in its\nplaintext body. The link token syntax is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:">>MSGLINK\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Where ",(0,t.jsx)(n.code,{children:"MSGLINK"})," is a message ID of exactly ",(0,t.jsx)(n.code,{children:"MSGLINKLEN"})," characters drawn from the URL-safe\nbase64 alphabet (",(0,t.jsx)(n.code,{children:"A-Z"}),", ",(0,t.jsx)(n.code,{children:"a-z"}),", ",(0,t.jsx)(n.code,{children:"0-9"}),", ",(0,t.jsx)(n.code,{children:"-"}),", ",(0,t.jsx)(n.code,{children:"_"}),"). The ",(0,t.jsx)(n.code,{children:">>"})," sigil introduces the reference.\nThe token ends at the first character that is not a valid message ID character or at end\nof string."]}),"\n",(0,t.jsxs)(n.p,{children:["Multiple references MAY appear in a single message body up to the ",(0,t.jsx)(n.code,{children:"MSGLINKMAX"})," limit.\nReferences MAY appear at any position in the body; they are not required to be at the\nstart of the line."]}),"\n",(0,t.jsxs)(n.p,{children:["A reference in a ",(0,t.jsx)(n.code,{children:"NOTICE"})," MUST NOT be resolved or annotated by the server."]}),"\n",(0,t.jsx)(n.h3,{id:"example-body-with-a-reference",children:"Example body with a reference"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:">>01HQ7K2N4R8VXJD3MCWBPZT56Y I agree with this point entirely.\n"})}),"\n",(0,t.jsx)(n.h2,{id:"client-rendering",children:"Client Rendering"}),"\n",(0,t.jsxs)(n.p,{children:["Clients that have negotiated this capability SHOULD NOT render any contextual quote or\npreview beside or above the referencing message. Clients SHOULD render the link in the\nstyle of a hyperlink ",(0,t.jsx)(n.code,{children:"[>#channel]"}),", but the specific rendering is implementation-defined."]}),"\n",(0,t.jsxs)(n.p,{children:["Clients that have not negotiated this capability receive messages with ",(0,t.jsx)(n.code,{children:">>MSGLINK"})," tokens\nas plain text and receive no preview tags. This is the correct degraded behaviour and\nrequires no special handling by the server."]}),"\n",(0,t.jsx)(n.h2,{id:"unresolvable-and-expired-references",children:"Unresolvable and Expired References"}),"\n",(0,t.jsx)(n.p,{children:"Servers are not required to retain messages indefinitely. A reference to a message whose\nID is no longer in the server's history store is silently unresolvable. Clients SHOULD NOT\nassume that an unresolved reference implies the referenced message never existed."}),"\n",(0,t.jsx)(n.h2,{id:"message-history",children:"Message History"}),"\n",(0,t.jsxs)(n.p,{children:["Servers that support message history replay (via ",(0,t.jsx)(n.code,{children:"CHATHISTORY"})," or an equivalent mechanism)\nMUST include the ",(0,t.jsx)(n.code,{children:"MSGLINK"})," tag on replayed messages exactly as it was assigned at\noriginal delivery time. Tag values MUST NOT be regenerated on replay."]}),"\n",(0,t.jsx)(n.p,{children:"If a client requests history for a channel or query target, the server MUST include message\nlink tags in the replayed batch in the same form they were delivered originally. Clients\nthat have not negotiated this capability receive history without these tags."}),"\n",(0,t.jsx)(n.h2,{id:"cross-channel-references",children:"Cross-Channel References"}),"\n",(0,t.jsx)(n.p,{children:"A client MAY reference a message from a different channel."}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"capability-negotiation",children:"Capability negotiation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"C: CAP LS 302\nS: CAP * LS :rsr.chat/message-link\nC: CAP REQ :rsr.chat/message-link\nS: CAP * ACK :rsr.chat/message-link\nC: NICK alice\nC: USER alice 0 * :Alice\nS: 005 alice MSGLINKMAX=5 MSGLINKLEN=26 :are supported by this server\nS: 001 alice :Welcome to the network\n"})}),"\n",(0,t.jsx)(n.h3,{id:"messages-delivered-with-id-tags",children:"Messages delivered with ID tags"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:":bob!bob@host PRIVMSG #engineering/general :The deploy pipeline is broken again.\n(alice receives this as:)\n@rsr.chat/MSGLINK=01HQ7K2N4R8VXJD3MCWBPZT56Y :bob!bob@host PRIVMSG #engineering/general :The deploy pipeline is broken again.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"sending-a-message-that-references-a-prior-one",children:"Sending a message that references a prior one"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"C: PRIVMSG #engineering/general :>>01HQ7K2N4R8VXJD3MCWBPZT56Y I've filed a ticket for this.\n\n(Other channel members that negotiated the capability receive:)\n@rsr.chat/MSGLINK=01HQAB3T2F7PPXC4NK8RWLM09S :alice!alice@host PRIVMSG #engineering/general :>>01HQ7K2N4R8VXJD3MCWBPZT56Y I've filed a ticket for this.\n\n(Channel members that did not negotiate the capability receive:)\n:alice!alice@host PRIVMSG #engineering/general :>>01HQ7K2N4R8VXJD3MCWBPZT56Y I've filed a ticket for this.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"exceeding-msglinkmax",children:"Exceeding MSGLINKMAX"}),"\n",(0,t.jsx)(n.p,{children:"(Server has MSGLINKMAX=2)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"C: PRIVMSG #engineering/general :>>ID1 >>ID2 >>ID3 too many refs.\nS: :server ERR_CANNOTSENDTOCHAN alice #engineering/general :Too many message link references\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);