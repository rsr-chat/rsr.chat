<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-proto/extensions/did-sasl" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">rsr.chat/did-sasl | RSR.CHAT</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.rsr.chat/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.rsr.chat/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.rsr.chat/docs/proto/extensions/did-sasl"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="rsr.chat/did-sasl | RSR.CHAT"><meta data-rh="true" name="description" content="This specification is still a draft and is subject to change at any time."><meta data-rh="true" property="og:description" content="This specification is still a draft and is subject to change at any time."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.rsr.chat/docs/proto/extensions/did-sasl"><link data-rh="true" rel="alternate" href="https://docs.rsr.chat/docs/proto/extensions/did-sasl" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.rsr.chat/docs/proto/extensions/did-sasl" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IRCv3 Extensions","item":"https://docs.rsr.chat/docs/proto/extensions/"},{"@type":"ListItem","position":2,"name":"rsr.chat/did-sasl","item":"https://docs.rsr.chat/docs/proto/extensions/did-sasl"}]}</script><link rel="stylesheet" href="/assets/css/styles.32a91367.css">
<script src="/assets/js/runtime~main.6cafa0fd.js" defer="defer"></script>
<script src="/assets/js/main.05a80a90.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RSR Virtual Chat Protocol</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/proto/intro">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/rsr-chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/intro"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/core-proto"><span title="Core IRCv3 Protocol" class="linkLabel_WmDU">Core IRCv3 Protocol</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/registration"><span title="Accounts and Registration" class="linkLabel_WmDU">Accounts and Registration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/data-ownership"><span title="Content Ownership Model" class="linkLabel_WmDU">Content Ownership Model</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/content-moderation"><span title="Content Moderation" class="linkLabel_WmDU">Content Moderation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/proto/extensions/"><span title="IRCv3 Extensions" class="categoryLinkLabel_W154">IRCv3 Extensions</span></a><button aria-label="Collapse sidebar category &#x27;IRCv3 Extensions&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/advanced-moderation"><span title="rsr.chat/advanced-moderation" class="linkLabel_WmDU">rsr.chat/advanced-moderation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/channel-categories"><span title="rsr.chat/channel-categories" class="linkLabel_WmDU">rsr.chat/channel-categories</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/channel-membership"><span title="rsr.chat/channel-membership" class="linkLabel_WmDU">rsr.chat/channel-membership</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/channel-meta"><span title="rsr.chat/channel-meta" class="linkLabel_WmDU">rsr.chat/channel-meta</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/channel-pins"><span title="rsr.chat/channel-pins" class="linkLabel_WmDU">rsr.chat/channel-pins</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/proto/extensions/did-sasl"><span title="rsr.chat/did-sasl" class="linkLabel_WmDU">rsr.chat/did-sasl</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/did-signing"><span title="rsr.chat/did-signing" class="linkLabel_WmDU">rsr.chat/did-signing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/emote"><span title="rsr.chat/emote" class="linkLabel_WmDU">rsr.chat/emote</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/extended-message-length"><span title="rsr.chat/extended-line-length" class="linkLabel_WmDU">rsr.chat/extended-line-length</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/message-link"><span title="rsr.chat/message-link" class="linkLabel_WmDU">rsr.chat/message-link</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/modern-ping"><span title="rsr.chat/modern-ping" class="linkLabel_WmDU">rsr.chat/modern-ping</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/onboarding"><span title="rsr.chat/onboarding" class="linkLabel_WmDU">rsr.chat/onboarding</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/pending-messages"><span title="rsr.chat/pending-messages" class="linkLabel_WmDU">rsr.chat/pending-messages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/rbac"><span title="rsr.chat/rbac" class="linkLabel_WmDU">rsr.chat/rbac</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/reactions"><span title="rsr.chat/reactions" class="linkLabel_WmDU">rsr.chat/reactions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/typing-notify"><span title="rsr.chat/typing-notify" class="linkLabel_WmDU">rsr.chat/typing-notify</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/video"><span title="rsr.chat/video" class="linkLabel_WmDU">rsr.chat/video</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/extensions/voice"><span title="rsr.chat/voice" class="linkLabel_WmDU">rsr.chat/voice</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/proto/lexicons/"><span title="ATProto Lexicons" class="categoryLinkLabel_W154">ATProto Lexicons</span></a><button aria-label="Expand sidebar category &#x27;ATProto Lexicons&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/proto/extensions/"><span>IRCv3 Extensions</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">rsr.chat/did-sasl</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This specification is still a <strong>draft</strong> and is subject to change at any time.</p></div></div>
<header><h1>rsr.chat/sasl-did</h1></header>
<p>This extension defines two SASL authentication mechanisms, <code>RSR-DID-WEB</code> and <code>RSR-DID-PLC</code>, that
allow clients to authenticate to IRC servers using W3C Decentralised Identifiers. Both
mechanisms use a server-issued challenge and a client-produced JSON Web Signature over
that challenge. The signature need not be produced inline during the SASL
exchange: clients may pre-request a challenge, complete an OAuth 2.0 delegated signing
flow with a provider that holds their key, and present the resulting signature in a
subsequent SASL exchange. The server validates the signature against the DID document
regardless of how the client obtained it.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<p>DID-based authentication allows users to authenticate using an identity they control
independently of the IRC network — rooted in a web domain they own (<code>did:web</code>) or in the
AT Protocol PLC directory (<code>did:plc</code>). However, not all clients hold private key material
directly. A user may delegate key custody to an OAuth-capable signing provider: an
identity wallet, an AT Protocol PDS, a hardware security device fronted by an API, or a
browser-based key store. Supporting these delegated signing arrangements requires
decoupling challenge issuance from the SASL exchange so that an interactive OAuth flow
can complete before the client presents its response. This specification supports both
direct signing (client holds the key) and delegated signing (client obtains a signature
from an OAuth provider) under the same mechanism names, with the server indifferent to
which path the client took.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="capability">Capability<a href="#capability" class="hash-link" aria-label="Direct link to Capability" title="Direct link to Capability" translate="no">​</a></h2>
<p>This extension supplements but does not replace the IRCv3 <code>sasl</code> capability and MUST
only be offered when <code>sasl</code> is also available.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CAP * LS :sasl=PLAIN,RSR-DID-WEB,RSR_DID-PLC</span><br></span></code></pre></div></div>
<p>Clients that wish to authenticate via a DID method MUST negotiate <code>sasl</code> and use the
<code>AUTHENTICATE</code> command with the mechanism name <code>RSR-DID-WEB</code> or <code>RSR-DID-PLC</code> as appropriate.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="isupport-tokens">ISUPPORT Tokens<a href="#isupport-tokens" class="hash-link" aria-label="Direct link to ISUPPORT Tokens" title="Direct link to ISUPPORT Tokens" translate="no">​</a></h2>
<p>Servers MUST advertise the following tokens in <code>RPL_ISUPPORT</code> (005) when this capability
is active:</p>
<ul>
<li class=""><code>DIDDNSTIMEOUT=&lt;ms&gt;</code> — the maximum time in milliseconds the server will wait for DID
document resolution. Recommended default: <code>5000</code>.</li>
<li class=""><code>DIDNONCELEN=&lt;n&gt;</code> — the byte length of server-generated nonces. Servers MUST NOT
enforce a value lower than 32.</li>
<li class=""><code>DIDCACHETTL=&lt;s&gt;</code> — seconds for which the server MAY cache a resolved DID document.
<code>0</code> means no caching.</li>
<li class=""><code>DIDINLINETTL=&lt;s&gt;</code> — seconds before an inline SASL challenge expires. Recommended
default: <code>60</code>. This is the window available to direct-signing clients.</li>
<li class=""><code>DIDPREISSUETTL=&lt;s&gt;</code> — seconds before a pre-issued challenge expires. Recommended
default: <code>600</code> (10 minutes). This is the window available to clients completing an
OAuth flow.</li>
<li class=""><code>DIDALGS=&lt;alg1&gt;,&lt;alg2&gt;,...</code> — supported JWS algorithm identifiers, in server
preference order.</li>
</ul>
<p>Example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">:server 005 nick DIDDNSTIMEOUT=5000 DIDNONCELEN=32 DIDCACHETTL=300 DIDINLINETTL=60 DIDPREISSUETTL=600 DIDALGS=EdDSA,ES256K,ES256 :are supported by this server</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="two-signing-flows">Two Signing Flows<a href="#two-signing-flows" class="hash-link" aria-label="Direct link to Two Signing Flows" title="Direct link to Two Signing Flows" translate="no">​</a></h2>
<p>Both <code>RSR-DID-WEB</code> and <code>RSR-DID-PLC</code> support two signing flows, declared by the client in its
initial SASL message. The server&#x27;s behaviour during verification is identical in both
cases; the flow distinction affects only challenge issuance timing and TTL.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="direct-flow">Direct Flow<a href="#direct-flow" class="hash-link" aria-label="Direct link to Direct Flow" title="Direct link to Direct Flow" translate="no">​</a></h3>
<p>The client holds the private key locally. The challenge is issued inline during the SASL
exchange and expires after <code>DIDINLINETTL</code> seconds. This is appropriate for clients with
direct access to key material.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="delegate-flow">Delegate Flow<a href="#delegate-flow" class="hash-link" aria-label="Direct link to Delegate Flow" title="Direct link to Delegate Flow" translate="no">​</a></h3>
<p>The client does not hold the private key directly and will obtain a signature from an
external OAuth-capable signing provider. To accommodate the interactive OAuth exchange,
the client pre-requests a challenge before starting SASL using the <code>DIDCHALLENGE</code> command
(see Pre-Issued Challenges). The pre-issued challenge expires after <code>DIDPREISSUETTL</code>
seconds. During the SASL exchange the client references the pre-issued challenge by its
ID rather than waiting for an inline challenge.</p>
<p>The server does not participate in the OAuth exchange and does not communicate with the
signing provider. From the server&#x27;s perspective, a delegate flow is simply a SASL
exchange in which the client presents a pre-computed JWS referencing a previously issued
challenge.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-issued-challenges">Pre-Issued Challenges<a href="#pre-issued-challenges" class="hash-link" aria-label="Direct link to Pre-Issued Challenges" title="Direct link to Pre-Issued Challenges" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="didchallenge-request">DIDCHALLENGE REQUEST<a href="#didchallenge-request" class="hash-link" aria-label="Direct link to DIDCHALLENGE REQUEST" title="Direct link to DIDCHALLENGE REQUEST" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DIDCHALLENGE REQUEST &lt;did&gt;</span><br></span></code></pre></div></div>
<p>Requests a challenge for the given DID without beginning SASL. The server resolves the
DID document (see Resolution and Validation) and, if resolution succeeds, issues a
challenge with a TTL of <code>DIDPREISSUETTL</code> seconds.</p>
<p>The server replies with <code>RPL_DIDCHALLENGE</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">:server RPL_DIDCHALLENGE &lt;nick&gt; &lt;challenge-id&gt; &lt;did&gt; :&lt;challenge-json-base64&gt;</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li class=""><code>challenge-id</code> is a server-generated opaque identifier for this pre-issued challenge,
distinct from the nonce. Clients include this ID in their SASL initial message to
indicate they are responding to a pre-issued challenge.</li>
<li class=""><code>challenge-json-base64</code> is the base64-encoded challenge JSON, identical in structure
to the inline challenge (see Server Challenge Message).</li>
</ul>
<p>Pre-issued challenges are bound to the connection that requested them. A challenge issued
on one connection MUST NOT be accepted on a different connection.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="didchallenge-cancel">DIDCHALLENGE CANCEL<a href="#didchallenge-cancel" class="hash-link" aria-label="Direct link to DIDCHALLENGE CANCEL" title="Direct link to DIDCHALLENGE CANCEL" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DIDCHALLENGE CANCEL &lt;challenge-id&gt;</span><br></span></code></pre></div></div>
<p>Cancels a pre-issued challenge. The server MUST discard the challenge immediately. This
SHOULD be called by the client if the OAuth flow fails or is abandoned, so that the
server can free the associated state.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="numerics">Numerics<a href="#numerics" class="hash-link" aria-label="Direct link to Numerics" title="Direct link to Numerics" translate="no">​</a></h3>
<table><thead><tr><th>Symbolic name</th><th>Description</th></tr></thead><tbody><tr><td>RPL_DIDCHALLENGE</td><td>A pre-issued challenge</td></tr><tr><td>ERR_DIDCHALLENGEFAIL</td><td>Challenge could not be issued (resolution failure, etc.)</td></tr><tr><td>ERR_DIDCHALLENGEUNKNOWN</td><td>The referenced challenge-id is not known or has expired</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="sasl-mechanism-rsr-did-web-and-rsr-did-plc">SASL Mechanism: RSR-DID-WEB and RSR-DID-PLC<a href="#sasl-mechanism-rsr-did-web-and-rsr-did-plc" class="hash-link" aria-label="Direct link to SASL Mechanism: RSR-DID-WEB and RSR-DID-PLC" title="Direct link to SASL Mechanism: RSR-DID-WEB and RSR-DID-PLC" translate="no">​</a></h2>
<p>The two mechanisms are identical in message structure. The mechanism name determines
which DID resolution method the server uses.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-client-initial-message">Step 1: Client Initial Message<a href="#step-1-client-initial-message" class="hash-link" aria-label="Direct link to Step 1: Client Initial Message" title="Direct link to Step 1: Client Initial Message" translate="no">​</a></h3>
<p>After sending <code>AUTHENTICATE RSR-DID-WEB</code> or <code>RSR-AUTHENTICATE DID-PLC</code> the server sends
<code>AUTHENTICATE +</code>. The client then sends its initial message as a base64-encoded JSON
object:</p>
<p>For a <strong>direct flow</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;flow&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;direct&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;did&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the client&#x27;s full DID string&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vmId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;verification method ID&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>For a <strong>delegate flow</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;flow&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;delegate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;did&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the client&#x27;s full DID string&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vmId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;verification method ID&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;challengeId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the challenge-id from a prior DIDCHALLENGE REQUEST&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Fields:</p>
<ul>
<li class=""><code>flow</code> — MUST be <code>direct</code> or <code>delegate</code>. Absent field MUST be treated as <code>direct</code>.</li>
<li class=""><code>did</code> — MUST be a syntactically valid DID matching the mechanism&#x27;s method. A
<code>DID-WEB</code> exchange MUST present a <code>did:web:...</code> DID; <code>DID-PLC</code> MUST present a
<code>did:plc:...</code> DID. Method mismatch MUST cause the server to abort with ERR_SASLFAIL.</li>
<li class=""><code>vmId</code> — the <code>id</code> of the verification method in the DID document the client will use
to sign. The server confirms this method exists and appears under <code>authentication</code>.</li>
<li class=""><code>challengeId</code> — delegate flow only. MUST reference a pre-issued challenge obtained
via <code>DIDCHALLENGE REQUEST</code> on this connection. If absent in a delegate flow, or if
the referenced challenge has expired or is unknown, the server MUST abort with
ERR_SASLFAIL.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-server-challenge-message">Step 2: Server Challenge Message<a href="#step-2-server-challenge-message" class="hash-link" aria-label="Direct link to Step 2: Server Challenge Message" title="Direct link to Step 2: Server Challenge Message" translate="no">​</a></h3>
<p><strong>Direct flow</strong>: The server issues a fresh challenge with TTL <code>DIDINLINETTL</code> and sends
it as a base64-encoded JSON object via <code>AUTHENTICATE</code>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;challengeId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;DIDNONCELEN random bytes, base64url-encoded&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;did&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the DID the server resolved, echoed&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vmId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the vmId echoed&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;ISO 8601 UTC timestamp of challenge issuance&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ttl&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &lt;DIDINLINETTL value in seconds&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Delegate flow</strong>: The server has already sent the challenge via RPL_DIDCHALLENGE. It
echoes the challenge ID to confirm it is accepted and proceeds immediately to await the
client response:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;challengeId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the challenge-id&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;nonce from the pre-issued challenge, verbatim&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;did&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;did echoed&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vmId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;vmId echoed&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;ts from the pre-issued challenge, verbatim&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ttl&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &lt;remaining TTL in seconds at time of SASL initiation&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In both cases the client MUST verify that the echoed <code>did</code> and <code>vmId</code> match its request
before signing.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-client-response">Step 3: Client Response<a href="#step-3-client-response" class="hash-link" aria-label="Direct link to Step 3: Client Response" title="Direct link to Step 3: Client Response" translate="no">​</a></h3>
<p>The client produces a JSON Web Signature (JWS, RFC 7515) in Compact Serialisation form
over the following payload and sends the result base64-encoded:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;did&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the client&#x27;s DID&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vmId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the verification method ID&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the nonce from the challenge, verbatim&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the ts from the challenge, verbatim&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the server&#x27;s hostname as presented in the 001 welcome message&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;flow&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;direct or delegate&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In a direct flow the client signs this payload with its locally held private key.</p>
<p>In a delegate flow the client passes this payload to its OAuth signing provider and
receives a signed JWS in return (see OAuth Delegation). The JWS presented to the server
is the one returned by the provider, not one produced by the client itself.</p>
<p>In either case:</p>
<ul>
<li class="">The JWS <code>alg</code> header MUST be one of the algorithms listed in <code>DIDALGS</code>.</li>
<li class="">The JWS <code>kid</code> header MUST be set to <code>vmId</code>.</li>
<li class="">The server MUST verify the <code>aud</code> claim matches its own hostname.</li>
<li class="">The server MUST verify the <code>nonce</code> and <code>ts</code> match the issued challenge.</li>
<li class="">The server MUST verify the challenge has not expired.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="server-verification">Server Verification<a href="#server-verification" class="hash-link" aria-label="Direct link to Server Verification" title="Direct link to Server Verification" translate="no">​</a></h3>
<p>On receipt of the client response the server MUST:</p>
<ol>
<li class="">Decode and parse the JWS.</li>
<li class="">Verify <code>aud</code> matches the server&#x27;s own hostname.</li>
<li class="">Locate the challenge (inline or pre-issued) and confirm it has not expired.</li>
<li class="">Verify the <code>nonce</code> and <code>ts</code> in the payload match the challenge verbatim.</li>
<li class="">Locate the verification method identified by <code>vmId</code> in the resolved DID document.</li>
<li class="">Verify the located method appears in the <code>authentication</code> verification relationship.</li>
<li class="">Extract the public key material from the verification method.</li>
<li class="">Validate the JWS signature against the payload using the extracted key.</li>
<li class="">Consume the nonce; it MUST NOT be accepted again.</li>
</ol>
<p>If all checks pass the server completes authentication with RPL_SASLSUCCESS (903). If any
check fails the server MUST reply with ERR_SASLFAIL (904) and MUST NOT disclose which
specific check failed.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="oauth-delegation">OAuth Delegation<a href="#oauth-delegation" class="hash-link" aria-label="Direct link to OAuth Delegation" title="Direct link to OAuth Delegation" translate="no">​</a></h2>
<p>This section describes the client-side OAuth delegation pattern. The server does not
participate in this flow and requires no OAuth-specific configuration.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h3>
<p>In the delegate flow, the user&#x27;s private key is held by an OAuth-capable signing
provider rather than the client. The DID document&#x27;s verification method references the
provider&#x27;s public key (or a key the provider holds on the user&#x27;s behalf). The client:</p>
<ol>
<li class="">Pre-requests a challenge from the IRC server via <code>DIDCHALLENGE REQUEST</code>.</li>
<li class="">Authenticates to the signing provider via an OAuth 2.0 flow.</li>
<li class="">Requests the provider to sign the JWS payload containing the IRC nonce.</li>
<li class="">Receives the signed JWS from the provider.</li>
<li class="">Presents the JWS to the IRC server via SASL.</li>
</ol>
<p>The signing provider sees and signs the IRC nonce but does not communicate with the IRC
server directly. The IRC server sees and verifies a JWS but does not communicate with
the provider. The client mediates between the two.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-document-convention-for-delegated-signing">DID Document Convention for Delegated Signing<a href="#did-document-convention-for-delegated-signing" class="hash-link" aria-label="Direct link to DID Document Convention for Delegated Signing" title="Direct link to DID Document Convention for Delegated Signing" translate="no">​</a></h3>
<p>Verification methods that represent keys held by a signing provider SHOULD include a
<code>serviceEndpoint</code> property pointing to the provider&#x27;s signing API. This is a convention
for client discovery; the server does not read or validate it:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;did:web:alice.example.com#key-oauth-1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JsonWebKey2020&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;controller&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;did:web:alice.example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;publicKeyJwk&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ... </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;serviceEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://wallet.example.com/sign&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Clients that discover a <code>serviceEndpoint</code> on the target verification method SHOULD use
it as the signing API endpoint for the delegate flow. Clients MUST NOT transmit the
<code>serviceEndpoint</code> to the IRC server.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="oauth-20-signing-flow">OAuth 2.0 Signing Flow<a href="#oauth-20-signing-flow" class="hash-link" aria-label="Direct link to OAuth 2.0 Signing Flow" title="Direct link to OAuth 2.0 Signing Flow" translate="no">​</a></h3>
<p>The specific OAuth grant type and API shape are defined by the signing provider. The
following is a RECOMMENDED approach that client and provider authors SHOULD follow for
interoperability.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-obtain-a-signing-token-via-oauth-20-with-pkce">1. Obtain a Signing Token via OAuth 2.0 with PKCE<a href="#1-obtain-a-signing-token-via-oauth-20-with-pkce" class="hash-link" aria-label="Direct link to 1. Obtain a Signing Token via OAuth 2.0 with PKCE" title="Direct link to 1. Obtain a Signing Token via OAuth 2.0 with PKCE" translate="no">​</a></h4>
<p>The client initiates a standard OAuth 2.0 authorisation code flow (RFC 6749) with PKCE
(RFC 7636) against the provider&#x27;s authorisation server. The requested scope SHOULD
include a provider-defined scope that grants signing permission, e.g. <code>irc:sign</code> or
<code>did:sign</code>. For non-interactive clients with pre-established credentials a client
credentials grant MAY be used instead.</p>
<p>Clients and providers that support OAuth 2.0 Pushed Authorisation Requests (PAR,
RFC 9126) SHOULD use PAR to bind the IRC challenge nonce to the authorisation request,
providing an additional binding between the OAuth flow and the IRC challenge:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /oauth/par</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;client_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;scope&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;irc:sign&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code_challenge&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code_challenge_method&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;S256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;irc_challenge_nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;the nonce from the IRC server&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The authorisation server MAY display the <code>irc_challenge_nonce</code> and the IRC server
hostname to the user during the consent screen so they can verify what they are
authorising.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-exchange-the-token-for-a-signature">2. Exchange the Token for a Signature<a href="#2-exchange-the-token-for-a-signature" class="hash-link" aria-label="Direct link to 2. Exchange the Token for a Signature" title="Direct link to 2. Exchange the Token for a Signature" translate="no">​</a></h4>
<p>After obtaining an access token the client calls the provider&#x27;s signing endpoint with
the JWS payload to be signed:</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: DPoP &lt;access-token&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;vmId&quot;: &quot;&lt;the verification method ID&gt;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;payload&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;did&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;vmId&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;nonce&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ts&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;aud&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;flow&quot;: &quot;delegate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>DPoP (RFC 9449) is RECOMMENDED for binding the access token to the signing request and
preventing token exfiltration. Providers that support DPoP MUST require it for signing
requests.</p>
<p>The provider signs the payload with the private key corresponding to <code>vmId</code>, constructs
the JWS in Compact Serialisation, and returns it:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;jws&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;header&gt;.&lt;payload&gt;.&lt;signature&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-present-the-jws-to-the-irc-server">3. Present the JWS to the IRC Server<a href="#3-present-the-jws-to-the-irc-server" class="hash-link" aria-label="Direct link to 3. Present the JWS to the IRC Server" title="Direct link to 3. Present the JWS to the IRC Server" translate="no">​</a></h4>
<p>The client uses the returned JWS as its SASL response in Step 3 of the SASL exchange.
The IRC server has no knowledge that the JWS was produced by a provider rather than the
client and validates it identically.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="non-interactive-delegate-flow">Non-Interactive Delegate Flow<a href="#non-interactive-delegate-flow" class="hash-link" aria-label="Direct link to Non-Interactive Delegate Flow" title="Direct link to Non-Interactive Delegate Flow" translate="no">​</a></h3>
<p>For automated clients that have a pre-established API relationship with a signing
provider (e.g. a bot whose key is managed by a secrets manager), the PKCE flow is
unnecessary. Such clients MAY use a client credentials grant or API key to obtain a
signing token and call the signing endpoint programmatically. Provided the total time
stays within <code>DIDPREISSUETTL</code> seconds this is operationally transparent.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-and-at-protocol-pds-signing">did<!-- -->:plc<!-- --> and AT Protocol PDS Signing<a href="#did-and-at-protocol-pds-signing" class="hash-link" aria-label="Direct link to did-and-at-protocol-pds-signing" title="Direct link to did-and-at-protocol-pds-signing" translate="no">​</a></h3>
<p>Users with a <code>did:plc</code> identity whose key is managed by an AT Protocol PDS SHOULD use
the PDS&#x27;s OAuth 2.0 interface as the signing provider. AT Protocol PDSes that implement
the AT Protocol OAuth specification expose a signing endpoint compatible with the
delegate flow described here. The PDS verification method in the DID document references
the PDS-held key, and the PDS signs the IRC challenge after the user authorises the
request via the standard AT Protocol OAuth consent flow.</p>
<p>Clients that target AT Protocol PDSes SHOULD use PAR with the <code>irc_challenge_nonce</code>
extension to bind the authorisation request to the IRC challenge. The PDS&#x27;s OAuth server
SHOULD surface the IRC server hostname and challenge timestamp on its consent screen.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-method-support">DID Method Support<a href="#did-method-support" class="hash-link" aria-label="Direct link to DID Method Support" title="Direct link to DID Method Support" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did">did<!-- -->:web<a href="#did" class="hash-link" aria-label="Direct link to did" title="Direct link to did" translate="no">​</a></h3>
<p>A <code>did:web</code> DID document is retrieved from an HTTPS endpoint derived from the DID:</p>
<table><thead><tr><th>DID</th><th>Document URL</th></tr></thead><tbody><tr><td><code>did:web:example.com</code></td><td><code>https://example.com/.well-known/did.json</code></td></tr><tr><td><code>did:web:example.com:users:alice</code></td><td><code>https://example.com/users/alice/did.json</code></td></tr></tbody></table>
<p>Servers MUST use HTTPS. Servers MUST NOT follow redirects to non-HTTPS endpoints. TLS
certificates MUST be validated. Non-200 responses and malformed JSON MUST fail with
ERR_SASLFAIL.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-1">did<!-- -->:plc<a href="#did-1" class="hash-link" aria-label="Direct link to did-1" title="Direct link to did-1" translate="no">​</a></h3>
<p>A <code>did:plc</code> DID document is retrieved from:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://plc.directory/&lt;did&gt;</span><br></span></code></pre></div></div>
<p>Servers MUST use the canonical PLC directory. Servers MUST NOT permit clients to specify
an alternative directory. TLS validation applies as for <code>did:web</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-algorithms">Supported Algorithms<a href="#supported-algorithms" class="hash-link" aria-label="Direct link to Supported Algorithms" title="Direct link to Supported Algorithms" translate="no">​</a></h2>
<p>Servers MUST support:</p>
<table><thead><tr><th>Algorithm</th><th>Description</th><th>Key type in DID document</th></tr></thead><tbody><tr><td><code>EdDSA</code></td><td>Ed25519 (RFC 8037)</td><td><code>JsonWebKey2020</code> or <code>Ed25519VerificationKey2020</code></td></tr><tr><td><code>ES256K</code></td><td>ECDSA with secp256k1 (RFC 8812)</td><td><code>JsonWebKey2020</code> or <code>EcdsaSecp256k1VerificationKey2019</code></td></tr><tr><td><code>ES256</code></td><td>ECDSA with P-256 (RFC 7518)</td><td><code>JsonWebKey2020</code></td></tr></tbody></table>
<p>Servers MAY support additional algorithms. <code>EdDSA</code> (Ed25519) is RECOMMENDED. Clients
SHOULD prefer it where their key material supports it.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resolution-and-validation">Resolution and Validation<a href="#resolution-and-validation" class="hash-link" aria-label="Direct link to Resolution and Validation" title="Direct link to Resolution and Validation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-document-requirements">DID Document Requirements<a href="#did-document-requirements" class="hash-link" aria-label="Direct link to DID Document Requirements" title="Direct link to DID Document Requirements" translate="no">​</a></h3>
<p>Before issuing any challenge (inline or pre-issued) the server MUST resolve and validate
the DID document. The server MUST confirm:</p>
<ul>
<li class="">The <code>id</code> field matches the client-presented DID by exact string equality.</li>
<li class="">A <code>verificationMethod</code> array is present with at least one entry.</li>
<li class="">The <code>vmId</code> specified by the client exists within <code>verificationMethod</code>.</li>
<li class="">The matching method contains <code>publicKeyJwk</code> or <code>publicKeyMultibase</code>.</li>
<li class="">The matching method is referenced from the <code>authentication</code> array.</li>
</ul>
<p>Failure on any condition MUST produce ERR_SASLFAIL for inline flows or
ERR_DIDCHALLENGEFAIL for pre-issued challenge requests.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resolution-security">Resolution Security<a href="#resolution-security" class="hash-link" aria-label="Direct link to Resolution Security" title="Direct link to Resolution Security" translate="no">​</a></h3>
<p>Servers MUST:</p>
<ul>
<li class="">Reject plain HTTP resolution.</li>
<li class="">Not follow redirects that cross scheme or target private or loopback address ranges.</li>
<li class="">Enforce <code>DIDDNSTIMEOUT</code> as a hard wall-clock deadline on the entire operation.</li>
<li class="">Reject response bodies larger than 64 KiB.</li>
<li class="">Not execute active content in the response.</li>
<li class="">Prefer <code>Content-Type: application/did+ld+json</code>; reject other types unless explicitly
configured to accept them.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="caching">Caching<a href="#caching" class="hash-link" aria-label="Direct link to Caching" title="Direct link to Caching" translate="no">​</a></h3>
<p>If <code>DIDCACHETTL</code> is non-zero the server MAY cache resolved documents by DID string for
the advertised TTL. Cached documents MUST be stored in memory only. Servers MUST NOT
cache resolution failures. Users who have recently rotated keys SHOULD wait for the
cache to expire before re-authenticating.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="account-association">Account Association<a href="#account-association" class="hash-link" aria-label="Direct link to Account Association" title="Direct link to Account Association" translate="no">​</a></h2>
<p>On successful authentication the server associates the client&#x27;s DID with their IRC
account. The following invariants MUST hold:</p>
<ul>
<li class="">A DID MAY be associated with at most one IRC account. Authentication from a DID
already associated with a different account MUST fail with ERR_SASLFAIL.</li>
<li class="">An IRC account MAY have multiple DIDs associated, subject to a server-configured limit.</li>
<li class="">Association is persistent across sessions.</li>
<li class="">The authenticated DID is exposed in WHOIS (see WHOIS Integration).</li>
</ul>
<p>Servers MAY support automatic account creation on first successful DID authentication
or MAY require pre-registration. If a client authenticates with a DID that has no
associated account and the server does not support auto-registration, the server MUST
return ERR_SASLFAIL and log the DID for operator review.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whois-integration">WHOIS Integration<a href="#whois-integration" class="hash-link" aria-label="Direct link to WHOIS Integration" title="Direct link to WHOIS Integration" translate="no">​</a></h2>
<p>When a client is authenticated via a DID mechanism the server MUST include the
authenticated DID in WHOIS via RPL_WHOISDID:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">:server RPL_WHOISDID &lt;querier&gt; &lt;nick&gt; :&lt;did&gt;</span><br></span></code></pre></div></div>
<p>Servers MUST include this in self-WHOIS. Servers MAY suppress it in WHOIS by other
users depending on server policy.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-rotation">Key Rotation<a href="#key-rotation" class="hash-link" aria-label="Direct link to Key Rotation" title="Direct link to Key Rotation" translate="no">​</a></h2>
<p>Rotating keys in the DID document does not invalidate existing sessions. Servers MAY
implement a <code>DIDSYNC</code> command or operator procedure to force re-authentication of active
sessions, outside the scope of this specification. Clients and signing providers that
rotate keys SHOULD re-authenticate at the next session.</p>
<p>For the delegate flow, key rotation at the signing provider requires updating the
verification method&#x27;s public key in the DID document and, if applicable, its
<code>serviceEndpoint</code>. Clients SHOULD request a fresh pre-issued challenge after a provider
key rotation rather than presenting a challenge resolved against a stale document.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="guild-integration">Guild Integration<a href="#guild-integration" class="hash-link" aria-label="Direct link to Guild Integration" title="Direct link to Guild Integration" translate="no">​</a></h2>
<p>When <code>rsr.chat/guild</code> is negotiated, a user&#x27;s DID serves as a portable identity anchor
for guild membership. Servers that support both this extension and <code>rsr.chat/guild</code> MAY
allow guild administrators to require DID-based authentication for guild join, rejecting
join attempts from accounts not authenticated via a DID mechanism.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="channel-membership-integration">Channel Membership Integration<a href="#channel-membership-integration" class="hash-link" aria-label="Direct link to Channel Membership Integration" title="Direct link to Channel Membership Integration" translate="no">​</a></h2>
<p>When <code>rsr.chat/channel-membership</code> is negotiated, persistent membership records MAY
store the authenticated DID alongside the account name as an informational field. This
field is not used for access control decisions unless <code>rsr.chat/rbac</code> defines rules that
reference it.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rbac-integration">RBAC Integration<a href="#rbac-integration" class="hash-link" aria-label="Direct link to RBAC Integration" title="Direct link to RBAC Integration" translate="no">​</a></h2>
<p>When <code>rsr.chat/rbac</code> is negotiated, the following permission identifiers are defined:</p>
<table><thead><tr><th>Permission identifier</th><th>Description</th></tr></thead><tbody><tr><td><code>did.auth.require</code></td><td>Only DID-authenticated clients may join or post</td></tr><tr><td><code>did.auth.method=did:web</code></td><td>Only did<!-- -->:web<!-- --> authenticated clients are permitted</td></tr><tr><td><code>did.auth.method=did:plc</code></td><td>Only did<!-- -->:plc<!-- --> authenticated clients are permitted</td></tr><tr><td><code>did.auth.flow=direct</code></td><td>Only direct-flow authenticated clients are permitted</td></tr><tr><td><code>did.auth.flow=delegate</code></td><td>Only delegate-flow authenticated clients are permitted</td></tr></tbody></table>
<p>RBAC rules using these identifiers MAY be scoped to a channel category or guild prefix
using the scope syntax defined by <code>rsr.chat/channel-categories</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-moderation-integration">Advanced Moderation Integration<a href="#advanced-moderation-integration" class="hash-link" aria-label="Direct link to Advanced Moderation Integration" title="Direct link to Advanced Moderation Integration" translate="no">​</a></h2>
<p>When <code>rsr.chat/advanced-moderation</code> is negotiated, the following predicates are defined:</p>
<table><thead><tr><th>Predicate</th><th>Matches when</th></tr></thead><tbody><tr><td><code>did:authenticated</code></td><td>The user is authenticated via any DID mechanism</td></tr><tr><td><code>did:method=did:web</code></td><td>The user is authenticated via did<!-- -->:web</td></tr><tr><td><code>did:method=did:plc</code></td><td>The user is authenticated via did<!-- -->:plc</td></tr><tr><td><code>did:flow=direct</code></td><td>The user authenticated via the direct signing flow</td></tr><tr><td><code>did:flow=delegate</code></td><td>The user authenticated via the OAuth delegate flow</td></tr><tr><td><code>did:domain=&lt;domain&gt;</code></td><td>The user&#x27;s did<!-- -->:web<!-- --> DID is rooted at the specified domain</td></tr><tr><td><code>did:value=&lt;did&gt;</code></td><td>The user&#x27;s authenticated DID matches exactly</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling-summary">Error Handling Summary<a href="#error-handling-summary" class="hash-link" aria-label="Direct link to Error Handling Summary" title="Direct link to Error Handling Summary" translate="no">​</a></h2>
<table><thead><tr><th>Condition</th><th>Response</th></tr></thead><tbody><tr><td>Method mismatch</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>DID resolution timeout</td><td>ERR_SASLFAIL or ERR_DIDCHALLENGEFAIL</td></tr><tr><td>DID document fetch non-200 or malformed</td><td>ERR_SASLFAIL or ERR_DIDCHALLENGEFAIL</td></tr><tr><td>vmId not found or not in authentication</td><td>ERR_SASLFAIL or ERR_DIDCHALLENGEFAIL</td></tr><tr><td>challengeId not found or expired</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>challengeId belongs to a different connection</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>Unsupported JWS algorithm</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>Signature verification failure</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>Nonce or timestamp mismatch</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>aud mismatch</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>Inline challenge expired</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>Pre-issued challenge expired</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>DID associated with a different account</td><td>ERR_SASLFAIL (904)</td></tr><tr><td>No account and no auto-registration</td><td>ERR_SASLFAIL (904)</td></tr></tbody></table>
<p>Servers MUST NOT distinguish between these conditions in the ERR_SASLFAIL message text
in order to avoid leaking information about account existence or document state.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nonce-freshness">Nonce Freshness<a href="#nonce-freshness" class="hash-link" aria-label="Direct link to Nonce Freshness" title="Direct link to Nonce Freshness" translate="no">​</a></h3>
<p>Nonces MUST be generated using a cryptographically secure random source. Nonces MUST be
single-use and MUST be consumed on first verification attempt regardless of success or
failure. A consumed nonce MUST NOT be reissued.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="challenge-binding">Challenge Binding<a href="#challenge-binding" class="hash-link" aria-label="Direct link to Challenge Binding" title="Direct link to Challenge Binding" translate="no">​</a></h3>
<p>Pre-issued challenges are bound to the connection that requested them. Servers MUST
reject a pre-issued challenge presented on a different connection than the one that
called <code>DIDCHALLENGE REQUEST</code>. This prevents challenge theft by a third party who
intercepts a challenge-id.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aud-binding">aud Binding<a href="#aud-binding" class="hash-link" aria-label="Direct link to aud Binding" title="Direct link to aud Binding" translate="no">​</a></h3>
<p>The <code>aud</code> claim in the JWS payload binds the signature to a specific IRC server hostname,
preventing cross-server replay. Servers MUST validate this claim. Clients in the delegate
flow MUST include the IRC server&#x27;s hostname in the payload they send to the signing
provider; providers SHOULD surface this value to the user during consent.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="delegate-flow-considerations">Delegate Flow Considerations<a href="#delegate-flow-considerations" class="hash-link" aria-label="Direct link to Delegate Flow Considerations" title="Direct link to Delegate Flow Considerations" translate="no">​</a></h3>
<p>In the delegate flow the signing provider sees the IRC nonce and could, in principle,
replay the signed JWS against the IRC server within the <code>DIDPREISSUETTL</code> window. Clients
SHOULD use providers they trust. Clients SHOULD use PAR with the <code>irc_challenge_nonce</code>
parameter and DPoP token binding when supported by the provider to reduce the window
for provider-side misuse.</p>
<p>The extended <code>DIDPREISSUETTL</code> window compared to <code>DIDINLINETTL</code> is a deliberate
trade-off: it accommodates interactive OAuth flows at the cost of a larger replay window.
Servers that are highly sensitive to replay risk MAY configure <code>DIDPREISSUETTL</code> lower
than the default, accepting that some OAuth flows may time out.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="did-document-injection">DID Document Injection<a href="#did-document-injection" class="hash-link" aria-label="Direct link to DID Document Injection" title="Direct link to DID Document Injection" translate="no">​</a></h3>
<p>Servers MUST compare the <code>id</code> field of a resolved document to the requested DID using
exact string equality. Servers MUST NOT accept a document whose <code>id</code> differs from the
requested DID even by case or Unicode normalisation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-compromise">Key Compromise<a href="#key-compromise" class="hash-link" aria-label="Direct link to Key Compromise" title="Direct link to Key Compromise" translate="no">​</a></h3>
<p>If a user&#x27;s private key (or the signing provider&#x27;s key) is compromised, an attacker can
authenticate until the key is rotated and the server&#x27;s cache expires. Users SHOULD rotate
keys promptly on suspected compromise and notify server operators so that cached documents
may be invalidated out-of-band.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="direct-flow-did-web">Direct flow: DID-WEB<a href="#direct-flow-did-web" class="hash-link" aria-label="Direct link to Direct flow: DID-WEB" title="Direct link to Direct flow: DID-WEB" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C: CAP LS 302</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: CAP * LS :sasl=PLAIN,DID-WEB,DID-PLC rsr.chat/sasl-did</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: CAP REQ :sasl rsr.chat/sasl-did</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: CAP * ACK :sasl rsr.chat/sasl-did</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE DID-WEB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE eyJmbG93IjoiZGlyZWN0IiwiZGlkIjoiZGlkOndlYjphbGljZS5leGFtcGxlLmNvbSIsInZtSWQiOiJkaWQ6d2ViOmFsaWNlLmV4YW1wbGUuY29tI2tleS0xIn0=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(server resolves https://alice.example.com/.well-known/did.json, issues inline challenge)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE eyJjaGFsbGVuZ2VJZCI6bnVsbCwibm9uY2UiOiJyYW5kb21ub25jZWJhc2U2NHVybCIsImRpZCI6ImRpZDp3ZWI6YWxpY2UuZXhhbXBsZS5jb20iLCJ2bUlkIjoiZGlkOndlYjphbGljZS5leGFtcGxlLmNvbSNrZXktMSIsInRzIjoiMjAyNC0wMy0xNVQxNDoyMjowMS4wMDBaIiwidHRsIjo2MH0=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE &lt;base64-encoded JWS signed by alice&#x27;s local key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 903 alice :Authentication successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: 001 alice :Welcome to the network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: 005 alice DIDDNSTIMEOUT=5000 DIDNONCELEN=32 DIDCACHETTL=300 DIDINLINETTL=60 DIDPREISSUETTL=600 DIDALGS=EdDSA,ES256K,ES256 :are supported by this server</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="delegate-flow-did-plc-via-at-protocol-pds">Delegate flow: DID-PLC via AT Protocol PDS<a href="#delegate-flow-did-plc-via-at-protocol-pds" class="hash-link" aria-label="Direct link to Delegate flow: DID-PLC via AT Protocol PDS" title="Direct link to Delegate flow: DID-PLC via AT Protocol PDS" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(before starting SASL, the client pre-requests a challenge)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: DIDCHALLENGE REQUEST did:plc:ewvi7nxzyoun6zhhandbv25b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(server resolves https://plc.directory/did:plc:ewvi7nxzyoun6zhhandbv25b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server RPL_DIDCHALLENGE alice ch_01HQ7K2N4R8VXJ did:plc:ewvi7nxzyoun6zhhandbv25b :eyJjaGFsbGVuZ2VJZCI6ImNoXzAxSFE3SzJONFI4VlhKIiwibm9uY2UiOiJyYW5kb21ub25jZSIsInRzIjoiMjAyNC0wMy0xNVQxNDoyMjowMS4wMDBaIiwidHRsIjo2MDB9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(client now initiates OAuth 2.0 + PKCE flow against the AT Protocol PDS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(PDS consent screen shows: &quot;IRC server irc.example.net is requesting a signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for challenge nonce aBcDeFgH... issued at 2024-03-15T14:22:01Z&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(user approves; client receives access token and calls PDS signing API)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(PDS returns signed JWS; entire OAuth + signing round-trip takes ~25 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(client now begins SASL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE DID-PLC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE eyJmbG93IjoiZGVsZWdhdGUiLCJkaWQiOiJkaWQ6cGxjOmV3dmk3bnh6eW91bjZ6aGhhbmRidjI1YiIsInZtSWQiOiJkaWQ6cGxjOmV3dmk3bnh6eW91bjZ6aGhhbmRidjI1YiNhdGpwcm90b0Jsa0UiLCJjaGFsbGVuZ2VJZCI6ImNoXzAxSFE3SzJONFI4VlhKIn0=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(server locates pre-issued challenge ch_01HQ7K2N4R8VXJ, confirms not expired,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echoes it back)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE eyJjaGFsbGVuZ2VJZCI6ImNoXzAxSFE3SzJONFI4VlhKIiwibm9uY2UiOiJyYW5kb21ub25jZSIsImRpZCI6ImRpZDpwbGM6ZXd2aTdueHp5b3VuNnpoaGFuZGJ2MjViIiwidm1JZCI6Ii4uLiIsInRzIjoiMjAyNC0wMy0xNVQxNDoyMjowMS4wMDBaIiwidHRsIjo1NzV9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE &lt;base64-encoded JWS returned by the AT Protocol PDS signing API&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 903 alice :Authentication successful</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-issued-challenge-cancelled-after-failed-oauth-flow">Pre-issued challenge cancelled after failed OAuth flow<a href="#pre-issued-challenge-cancelled-after-failed-oauth-flow" class="hash-link" aria-label="Direct link to Pre-issued challenge cancelled after failed OAuth flow" title="Direct link to Pre-issued challenge cancelled after failed OAuth flow" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C: DIDCHALLENGE REQUEST did:web:alice.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server RPL_DIDCHALLENGE alice ch_01HQAB3T2F cancelled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(OAuth flow fails at provider; client cleans up)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: DIDCHALLENGE CANCEL ch_01HQAB3T2F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(server discards the challenge)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="whois-showing-authenticated-did-and-flow">WHOIS showing authenticated DID and flow<a href="#whois-showing-authenticated-did-and-flow" class="hash-link" aria-label="Direct link to WHOIS showing authenticated DID and flow" title="Direct link to WHOIS showing authenticated DID and flow" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C: WHOIS alice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 311 bob alice ~alice alice.example.com * :Alice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server RPL_WHOISDID bob alice :did:plc:ewvi7nxzyoun6zhhandbv25b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 318 bob alice :End of /WHOIS list</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resolution-failure-during-didchallenge-request">Resolution failure during DIDCHALLENGE REQUEST<a href="#resolution-failure-during-didchallenge-request" class="hash-link" aria-label="Direct link to Resolution failure during DIDCHALLENGE REQUEST" title="Direct link to Resolution failure during DIDCHALLENGE REQUEST" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C: DIDCHALLENGE REQUEST did:web:unreachable.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server ERR_DIDCHALLENGEFAIL alice :DID document could not be resolved</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="expired-pre-issued-challenge-presented-in-sasl">Expired pre-issued challenge presented in SASL<a href="#expired-pre-issued-challenge-presented-in-sasl" class="hash-link" aria-label="Direct link to Expired pre-issued challenge presented in SASL" title="Direct link to Expired pre-issued challenge presented in SASL" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(challenge ch_01HQ7K issued 620 seconds ago; DIDPREISSUETTL=600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE DID-WEB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE &lt;initial message referencing ch_01HQ7K&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 904 alice :SASL authentication failed</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="challenge-presented-on-wrong-connection">Challenge presented on wrong connection<a href="#challenge-presented-on-wrong-connection" class="hash-link" aria-label="Direct link to Challenge presented on wrong connection" title="Direct link to Challenge presented on wrong connection" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(ch_01HQCD was issued on a different connection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE DID-WEB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: AUTHENTICATE +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: AUTHENTICATE &lt;initial message referencing ch_01HQCD&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S: :server 904 alice :SASL authentication failed</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/proto/extensions/channel-pins"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">rsr.chat/channel-pins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/proto/extensions/did-signing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">rsr.chat/did-signing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#capability" class="table-of-contents__link toc-highlight">Capability</a></li><li><a href="#isupport-tokens" class="table-of-contents__link toc-highlight">ISUPPORT Tokens</a></li><li><a href="#two-signing-flows" class="table-of-contents__link toc-highlight">Two Signing Flows</a><ul><li><a href="#direct-flow" class="table-of-contents__link toc-highlight">Direct Flow</a></li><li><a href="#delegate-flow" class="table-of-contents__link toc-highlight">Delegate Flow</a></li></ul></li><li><a href="#pre-issued-challenges" class="table-of-contents__link toc-highlight">Pre-Issued Challenges</a><ul><li><a href="#didchallenge-request" class="table-of-contents__link toc-highlight">DIDCHALLENGE REQUEST</a></li><li><a href="#didchallenge-cancel" class="table-of-contents__link toc-highlight">DIDCHALLENGE CANCEL</a></li><li><a href="#numerics" class="table-of-contents__link toc-highlight">Numerics</a></li></ul></li><li><a href="#sasl-mechanism-rsr-did-web-and-rsr-did-plc" class="table-of-contents__link toc-highlight">SASL Mechanism: RSR-DID-WEB and RSR-DID-PLC</a><ul><li><a href="#step-1-client-initial-message" class="table-of-contents__link toc-highlight">Step 1: Client Initial Message</a></li><li><a href="#step-2-server-challenge-message" class="table-of-contents__link toc-highlight">Step 2: Server Challenge Message</a></li><li><a href="#step-3-client-response" class="table-of-contents__link toc-highlight">Step 3: Client Response</a></li><li><a href="#server-verification" class="table-of-contents__link toc-highlight">Server Verification</a></li></ul></li><li><a href="#oauth-delegation" class="table-of-contents__link toc-highlight">OAuth Delegation</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#did-document-convention-for-delegated-signing" class="table-of-contents__link toc-highlight">DID Document Convention for Delegated Signing</a></li><li><a href="#oauth-20-signing-flow" class="table-of-contents__link toc-highlight">OAuth 2.0 Signing Flow</a></li><li><a href="#non-interactive-delegate-flow" class="table-of-contents__link toc-highlight">Non-Interactive Delegate Flow</a></li><li><a href="#did-and-at-protocol-pds-signing" class="table-of-contents__link toc-highlight">did and AT Protocol PDS Signing</a></li></ul></li><li><a href="#did-method-support" class="table-of-contents__link toc-highlight">DID Method Support</a><ul><li><a href="#did" class="table-of-contents__link toc-highlight">did</a></li><li><a href="#did-1" class="table-of-contents__link toc-highlight">did</a></li></ul></li><li><a href="#supported-algorithms" class="table-of-contents__link toc-highlight">Supported Algorithms</a></li><li><a href="#resolution-and-validation" class="table-of-contents__link toc-highlight">Resolution and Validation</a><ul><li><a href="#did-document-requirements" class="table-of-contents__link toc-highlight">DID Document Requirements</a></li><li><a href="#resolution-security" class="table-of-contents__link toc-highlight">Resolution Security</a></li><li><a href="#caching" class="table-of-contents__link toc-highlight">Caching</a></li></ul></li><li><a href="#account-association" class="table-of-contents__link toc-highlight">Account Association</a></li><li><a href="#whois-integration" class="table-of-contents__link toc-highlight">WHOIS Integration</a></li><li><a href="#key-rotation" class="table-of-contents__link toc-highlight">Key Rotation</a></li><li><a href="#guild-integration" class="table-of-contents__link toc-highlight">Guild Integration</a></li><li><a href="#channel-membership-integration" class="table-of-contents__link toc-highlight">Channel Membership Integration</a></li><li><a href="#rbac-integration" class="table-of-contents__link toc-highlight">RBAC Integration</a></li><li><a href="#advanced-moderation-integration" class="table-of-contents__link toc-highlight">Advanced Moderation Integration</a></li><li><a href="#error-handling-summary" class="table-of-contents__link toc-highlight">Error Handling Summary</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a><ul><li><a href="#nonce-freshness" class="table-of-contents__link toc-highlight">Nonce Freshness</a></li><li><a href="#challenge-binding" class="table-of-contents__link toc-highlight">Challenge Binding</a></li><li><a href="#aud-binding" class="table-of-contents__link toc-highlight">aud Binding</a></li><li><a href="#delegate-flow-considerations" class="table-of-contents__link toc-highlight">Delegate Flow Considerations</a></li><li><a href="#did-document-injection" class="table-of-contents__link toc-highlight">DID Document Injection</a></li><li><a href="#key-compromise" class="table-of-contents__link toc-highlight">Key Compromise</a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#direct-flow-did-web" class="table-of-contents__link toc-highlight">Direct flow: DID-WEB</a></li><li><a href="#delegate-flow-did-plc-via-at-protocol-pds" class="table-of-contents__link toc-highlight">Delegate flow: DID-PLC via AT Protocol PDS</a></li><li><a href="#pre-issued-challenge-cancelled-after-failed-oauth-flow" class="table-of-contents__link toc-highlight">Pre-issued challenge cancelled after failed OAuth flow</a></li><li><a href="#whois-showing-authenticated-did-and-flow" class="table-of-contents__link toc-highlight">WHOIS showing authenticated DID and flow</a></li><li><a href="#resolution-failure-during-didchallenge-request" class="table-of-contents__link toc-highlight">Resolution failure during DIDCHALLENGE REQUEST</a></li><li><a href="#expired-pre-issued-challenge-presented-in-sasl" class="table-of-contents__link toc-highlight">Expired pre-issued challenge presented in SASL</a></li><li><a href="#challenge-presented-on-wrong-connection" class="table-of-contents__link toc-highlight">Challenge presented on wrong connection</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.rsr.chat" target="_blank" rel="noopener noreferrer" class="footer__link-item">TODO</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/rsr.chat" target="_blank" rel="noopener noreferrer" class="footer__link-item">BlueSky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025-2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>